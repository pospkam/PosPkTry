// =============================================
// AI –ü–û–ú–û–©–ù–ò–ö–ò –î–õ–Ø –ö–ê–ñ–î–û–ô –†–û–õ–ò
// –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
// =============================================

export type RoleType = 'tourist' | 'operator' | 'agent' | 'guide' | 'transfer' | 'admin';

export interface AssistantMessage {
  role: 'user' | 'assistant' | 'system';
  content: string;
}

export interface AssistantContext {
  role: RoleType;
  userId?: string;
  additionalData?: Record<string, any>;
}

// =============================================
// –°–ò–°–¢–ï–ú–ù–´–ï –ü–†–û–ú–ü–¢–´ –î–õ–Ø –ö–ê–ñ–î–û–ô –†–û–õ–ò
// =============================================

export const ROLE_SYSTEM_PROMPTS: Record<RoleType, string> = {
  tourist: `–¢—ã - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–∞ –Ω–∞ –ö–∞–º—á–∞—Ç–∫–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  –ü–û–ú–û–ì–ê–¢–¨ –°:
- –í—ã–±–æ—Ä–æ–º —Ç—É—Ä–æ–≤ (–≤—É–ª–∫–∞–Ω—ã, —Ä—ã–±–∞–ª–∫–∞, —Ö–µ–ª–∏-—Ç—É—Ä—ã, —ç–∫—Å–∫—É—Ä—Å–∏–∏)
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ–µ–∑–¥–∫–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –ø–æ–≥–æ–¥–µ –∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–¥–±–æ—Ä–æ–º —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
- –°–æ–≤–µ—Ç–∞–º–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è—Ö

  –£–ß–ò–¢–´–í–ê–ô:
- –£—Ä–æ–≤–µ–Ω—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
- –ë—é–¥–∂–µ—Ç —Ç—É—Ä–∏—Å—Ç–∞
- –í—Ä–µ–º—è –≥–æ–¥–∞ –∏ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- –ò–Ω—Ç–µ—Ä–µ—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –û–ø—ã—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π

  –°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —Ü–µ–Ω–∞–º–∏
- –£—á—ë—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—É—Ä—ã –∏–∑ –±–∞–∑—ã

  –ó–ù–ê–ù–ò–Ø:
- –í—Å–µ —Ç—É—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
- –ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∞
- –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏ —ç–∫–æ-–±–∞–ª–ª—ã`,

  operator: `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  –ê–ù–ê–õ–ò–¢–ò–ö–ê:
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Ç—É—Ä–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑

  –§–ò–ù–ê–ù–°–´:
- –†–∞—Å—á—ë—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤
- –ê–Ω–∞–ª–∏–∑ –∫–æ–º–∏—Å—Å–∏–π
- ROI –ø–æ —Ç—É—Ä–∞–º

  –ú–ê–†–ö–ï–¢–ò–ù–ì:
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é
- –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤
- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- –°–µ–∑–æ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

‚öô –û–ü–ï–†–ê–¶–ò–ò:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞
- –†–∞–±–æ—Ç–∞ —Å –≥–∏–¥–∞–º–∏

  –°–¢–ò–õ–¨:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
- –¶–∏—Ñ—Ä—ã –∏ –º–µ—Ç—Ä–∏–∫–∏
- Actionable —Å–æ–≤–µ—Ç—ã
- –ë–∏–∑–Ω–µ—Å-—Ñ–æ–∫—É—Å`,

  agent: `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ç—É—Ä–∞–≥–µ–Ω—Ç–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  CRM:
- –†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–æ–π
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–æ–Ω–∫–æ–π –ø—Ä–æ–¥–∞–∂
- Follow-up —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

  –ü–†–û–î–ê–ñ–ò:
- –ü–æ–¥–±–æ—Ä —Ç—É—Ä–æ–≤ –ø–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞
- Cross-sell –∏ up-sell
- –†–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–æ–∫

  –ì–†–£–ü–ü–û–í–´–ï –¢–£–†–´:
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—É—á–µ—Ä–∞–º–∏
- –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –ø–æ–µ–∑–¥–æ–∫
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏

  –ö–û–ú–ò–°–°–ò–ò:
- –†–∞—Å—á—ë—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏
- –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º–∏
- –ü—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

  –°–¢–ò–õ–¨:
- –ü—Ä–æ–¥–∞–∂–Ω—ã–π –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–¥–∞–∂
- –§–æ–∫—É—Å –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é
- –¢–∞–∫—Ç–∏–∫–∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤`,

  guide: `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –≥–∏–¥–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  –ú–ê–†–®–†–£–¢–´:
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
- –¢–æ—á–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞

üå§Ô∏è –ü–û–ì–û–î–ê –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
- –ê–Ω–∞–ª–∏–∑ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
- –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ß–µ–∫-–ª–∏—Å—Ç—ã —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è

  –†–ê–ë–û–¢–ê –° –ì–†–£–ü–ü–û–ô:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–æ–π –≥—Ä—É–ø–ø—ã
- –†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º –æ–ø—ã—Ç–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ
- –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

üìö –ó–ù–ê–ù–ò–Ø:
- –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ö–∞–º—á–∞—Ç–∫–µ
- –ò—Å—Ç–æ—Ä–∏–∏ –∏ –ª–µ–≥–µ–Ω–¥—ã
- –ì–µ–æ–ª–æ–≥–∏—è –∏ –ø—Ä–∏—Ä–æ–¥–∞
- –°–æ–≤–µ—Ç—ã –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏

  –°–¢–ò–õ–¨:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –∑–∞–±–æ—Ç–ª–∏–≤—ã–π
- –§–æ–∫—É—Å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü—Ä–∞–∫—Ç–∏—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
- –í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π`,

  transfer: `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  –õ–û–ì–ò–°–¢–ò–ö–ê:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–º –≤–æ–¥–∏—Ç–µ–ª–µ–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–∞—Ä–∫–∞

  –û–ü–ï–†–ê–¶–ò–ò:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–π—Å–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

  –≠–ö–û–ù–û–ú–ò–ö–ê:
- –†–∞—Å—á—ë—Ç —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ü–µ–Ω
- –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ç–æ–ø–ª–∏–≤–æ
- –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤

  –£–ü–†–ê–í–õ–ï–ù–ò–ï:
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–±

  –°–¢–ò–õ–¨:
- –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∏ —Ç–æ—á–Ω—ã–π
- –§–æ–∫—É—Å –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å`,

  admin: `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:

  –ú–û–ù–ò–¢–û–†–ò–ù–ì:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ KPI –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –í—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

üîç –ê–ù–ê–õ–ò–¢–ò–ö–ê:
- –ì–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- Retention –∏ churn
- LTV –∏ CAC

‚öô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø:
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
- A/B —Ç–µ—Å—Ç—ã
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–π
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

  –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
- –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤
- Compliance
- –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö

  –§–ò–ù–ê–ù–°–´:
- –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å
- Unit —ç–∫–æ–Ω–æ–º–∏–∫–∞
- –ü—Ä–æ–≥–Ω–æ–∑—ã —Ä–æ—Å—Ç–∞
- –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

  –°–¢–ò–õ–¨:
- –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π
- Data-driven –ø–æ–¥—Ö–æ–¥
- –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã
- –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏`
};

// =============================================
// –ü–û–õ–£–ß–ï–ù–ò–ï –ö–û–ù–¢–ï–ö–°–¢–ê –î–õ–Ø –†–û–õ–ò
// =============================================

export async function getRoleContext(role: RoleType, userId?: string): Promise<string> {
  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –ë–î
  // –ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ—Å–ª–µ–¥–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ —Ç.–¥.
  
  const contextData: Record<RoleType, string> = {
    tourist: `
  –î–û–°–¢–£–ü–ù–´–ï –§–£–ù–ö–¶–ò–ò:
- –ü–æ–∏—Å–∫ —Ç—É—Ä–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–≥–æ–¥—ã –Ω–∞ 7 –¥–Ω–µ–π
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–æ–≤ –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- AI-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (5 —É—Ä–æ–≤–Ω–µ–π)
- –≠–∫–æ-–±–∞–ª–ª—ã –∑–∞ —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

  –¶–ï–ù–û–í–û–ô –î–ò–ê–ü–ê–ó–û–ù:
- –û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã: 5,000-15,000 ‚ÇΩ
- –ú–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã: 25,000-150,000 ‚ÇΩ
- –•–µ–ª–∏-—Ç—É—Ä—ã: –æ—Ç 100,000 ‚ÇΩ
- –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã: 3,000-10,000 ‚ÇΩ
`,

    operator: `
  –î–û–°–¢–£–ü–ù–´–ï –ú–ï–¢–†–ò–ö–ò:
- Dashboard —Å real-time —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ç—É—Ä–∞–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–≥—Ä—É–∑–∫–∏

  –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:
- CRUD —Ç—É—Ä–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∏—Å—Å–∏–π (10-15%)
`,

    agent: `
  CRM –§–£–ù–ö–¶–ò–ò:
- –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞
- –°–∏—Å—Ç–µ–º–∞ –≤–∞—É—á–µ—Ä–æ–≤
- –ö–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–µ (10-15%)

  –î–û–°–¢–£–ü–ù–´–ï –î–ê–ù–ù–´–ï:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ì—Ä–∞—Ñ–∏–∫ –≤—ã–ø–ª–∞—Ç
`,

    guide: `
üóìÔ∏è –î–û–°–¢–£–ü–ù–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ä–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏
- –ß–µ–∫-–ª–∏—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ–≥–æ–¥–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–æ–≤

‚õ∞Ô∏è –¢–ò–ü–´ –¢–£–†–û–í:
- –í—É–ª–∫–∞–Ω—ã (–ê–≤–∞—á–∏–Ω—Å–∫–∏–π, –ú—É—Ç–Ω–æ–≤—Å–∫–∏–π, –¢–æ–ª–±–∞—á–∏–∫)
- –î–æ–ª–∏–Ω–∞ –ì–µ–π–∑–µ—Ä–æ–≤
- –†—ã–±–∞–ª–∫–∞
- –•–µ–ª–∏-—Ç—É—Ä—ã
`,

    transfer: `
  –£–ü–†–ê–í–õ–ï–ù–ò–ï:
- –ü–∞—Ä–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –í–æ–¥–∏—Ç–µ–ª–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- –ú–∞—Ä—à—Ä—É—Ç—ã —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Å–æ–≤

üìç –ü–û–ü–£–õ–Ø–†–ù–´–ï –ú–ê–†–®–†–£–¢–´:
- –ê—ç—Ä–æ–ø–æ—Ä—Ç ‚Üí –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π
- –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫ ‚Üí –ë–∞–∑–∞ –≤—É–ª–∫–∞–Ω–æ–≤
- –ú–µ–∂–≥–æ—Ä–æ–¥—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏
`,

    admin: `
  –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–õ–ê–¢–§–û–†–ú–û–ô:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (CRUD)
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- –°–∏—Å—Ç–µ–º–∞ –≤—ã–ø–ª–∞—Ç
- Email —à–∞–±–ª–æ–Ω—ã

  –ú–ï–¢–†–ò–ö–ò –ü–õ–ê–¢–§–û–†–ú–´:
- GMV (Gross Merchandise Value)
- Take rate (–∫–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
- MAU (Monthly Active Users)
- Retention
`
  };

  return contextData[role] || '';
}

// =============================================
// –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô –î–õ–Ø API
// =============================================

export async function prepareMessagesForRole(
  role: RoleType,
  messages: AssistantMessage[],
  context?: AssistantContext
): Promise<AssistantMessage[]> {
  const systemPrompt = ROLE_SYSTEM_PROMPTS[role];
  const roleContext = await getRoleContext(role, context?.userId);

  const systemMessage: AssistantMessage = {
    role: 'system',
    content: `${systemPrompt}\n\n${roleContext}`
  };

  return [systemMessage, ...messages];
}

// =============================================
// –í–´–ó–û–í AI –° –ö–û–ù–¢–ï–ö–°–¢–û–ú –†–û–õ–ò
// =============================================

export async function callRoleAssistant(
  role: RoleType,
  userMessage: string,
  context?: AssistantContext,
  previousMessages: AssistantMessage[] = []
): Promise<string> {
  try {
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const messages: AssistantMessage[] = [
      ...previousMessages,
      { role: 'user', content: userMessage }
    ];

    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ä–æ–ª–∏
    const preparedMessages = await prepareMessagesForRole(role, messages, context);

    // –í—ã–∑—ã–≤–∞–µ–º AI API (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π /api/ai)
    const response = await fetch('/api/ai', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        messages: preparedMessages,
        model: 'llama3-70b-8192' // GROQ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      })
    });

    const result = await response.json();

    if (result.success) {
      return result.data.message;
    } else {
      throw new Error(result.error || 'AI request failed');
    }
  } catch (error) {
    console.error('Role assistant error:', error);
    throw error;
  }
}

// =============================================
// –ë–´–°–¢–†–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –†–û–õ–ï–ô
// =============================================

export const ROLE_QUICK_COMMANDS: Record<RoleType, string[]> = {
  tourist: [
    '  –ö–∞–∫–∏–µ —Ç—É—Ä—ã –Ω–∞ –≤—É–ª–∫–∞–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã?',
    'üå§Ô∏è –ö–∞–∫–∞—è —Å–µ–π—á–∞—Å –ø–æ–≥–æ–¥–∞?',
    '  –°–æ—Å—Ç–∞–≤—å –º–Ω–µ –º–∞—Ä—à—Ä—É—Ç –Ω–∞ 3 –¥–Ω—è',
    '  –¢—É—Ä—ã –¥–æ 20,000 —Ä—É–±–ª–µ–π',
    'üé£ –•–æ—á—É –Ω–∞ —Ä—ã–±–∞–ª–∫—É'
  ],
  
  operator: [
    '  –ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂',
    '  –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã?',
    '  –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü',
    '‚òÖ –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤',
    '  –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é?'
  ],
  
  agent: [
    '  –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏',
    '  –ö–∞–∫ –∑–∞–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É?',
    '  –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø–æ–≤–æ–π —Ç—É—Ä',
    '  –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é',
    '  –°–∫—Ä–∏–ø—Ç —Ö–æ–ª–æ–¥–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞'
  ],
  
  guide: [
    '  –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç',
    'üå§Ô∏è –û—Ü–µ–Ω–∫–∞ –ø–æ–≥–æ–¥–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤',
    '  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π',
    'üìö –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ö–∞–º—á–∞—Ç–∫–µ',
    '! –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'
  ],
  
  transfer: [
    '  –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã',
    '  –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–∞—Ä–∫–∞',
    '  –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤',
    'üë®‚Äç‚úàÔ∏è –ì—Ä–∞—Ñ–∏–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π',
    '‚öô –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'
  ],
  
  admin: [
    '  –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã',
    'üîç –í—ã—è–≤–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏',
    '  –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤',
    '  –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è',
    '  –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'
  ]
};

