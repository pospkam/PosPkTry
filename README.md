# Kamhub ‚Äî –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ö–∞–º—á–∞—Ç–∫–∏ üèîÔ∏è

> –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–æ–≤, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –∏ –∂–∏–ª—å—è –Ω–∞ –ö–∞–º—á–∞—Ç–∫–µ

[![Next.js](https://img.shields.io/badge/Next.js-15-black)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.4-blue)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind-3.4-38bdf8)](https://tailwindcss.com/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-336791)](https://www.postgresql.org/)
[![pgvector](https://img.shields.io/badge/pgvector-semantic%20search-orange)](#)
[![Build](https://img.shields.io/badge/build-passing-brightgreen)](#)
[![React Doctor](https://img.shields.io/badge/React%20Doctor-99%2F100-brightgreen)](https://react.doctor)

**Production:** https://pospk-kamhub-c8e0.twc1.net

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

**Kamhub** ‚Äî —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ö–∞–º—á–∞—Ç–∫–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

- üé£ –†—ã–±–∞–ª–∫–∞ –Ω–∞ –ª–æ—Å–æ—Å—è (—á–∞–≤—ã—á–∞, –∫–∏–∂—É—á, –Ω–µ—Ä–∫–∞)
- üåã –í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ –≤—É–ª–∫–∞–Ω—ã
- ‚ô®Ô∏è –ì–æ—Ä—è—á–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- üöó –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã –∏ –∞—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ
- üè† –ñ–∏–ª—å—ë (–≥–æ—Å—Ç–∏–Ω–∏—Ü—ã, –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –∫–æ—Ç—Ç–µ–¥–∂–∏)
- üõí –ú–∞–≥–∞–∑–∏–Ω —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –∏ —Å—É–≤–µ–Ω–∏—Ä–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏
- ü§ñ –†–æ–ª–µ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –ø–∞–º—è—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (DeepSeek, Minimax, x.ai)
- üîç –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ pgvector (RAG)
- üñºÔ∏è –ê–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥ —Ñ–æ—Ç–æ —Ç—É—Ä–æ–≤ —á–µ—Ä–µ–∑ Claude Vision
- üéØ –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫—ç—à 24—á)
- –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã: —Ç—É—Ä–∏—Å—Ç, –≥–∏–¥, –∞–≥–µ–Ω—Ç, –æ–ø–µ—Ä–∞—Ç–æ—Ä, –ø–∞—Ä—Ç–Ω—ë—Ä, admin
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–æ–≤, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤, –∂–∏–ª—å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–≥–æ–¥–Ω—ã–π –≤–∏–¥–∂–µ—Ç (–Ø–Ω–¥–µ–∫—Å.–ü–æ–≥–æ–¥–∞)
- Glassmorphism UI —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç—ë–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
- –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Timeweb Cloud MCP –ø—Ä—è–º–æ –∏–∑ GitHub Copilot

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm ci

# Dev —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 3000)
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build

# –¢–µ—Å—Ç—ã
npm test

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npm run type-check
```

–î–ª—è Cloud Agents —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω—è—Ç—å `npm ci` –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à `~/.npm` + `node_modules` –ø–æ —Ö–µ—à—É `package-lock.json`.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env.local`:

```env
JWT_SECRET=your_secret_min_32_chars
DATABASE_URL=postgresql://user:pass@host:5432/kamhub
NEXTAUTH_SECRET=your_nextauth_secret
TIMEWEB_TOKEN=your_timeweb_api_token
MCHS_API_URL=https://your-mchs-endpoint.example/api/register-group
MCHS_API_TOKEN=your_mchs_api_token

# AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
DEEPSEEK_API_KEY=      # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —á–∞—Ç–∞
OPENAI_API_KEY=        # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
ANTHROPIC_API_KEY=     # Claude Vision –¥–ª—è –∞–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥–∞ —Ñ–æ—Ç–æ
MINIMAX_API_KEY=
XAI_API_KEY=

# URL -> Markdown –¥–ª—è RAG
MARKDOWN_NEW_ENDPOINT=https://markdown.new/
KNOWLEDGE_BASE_SOURCE_URLS=https://fishingkam.ru,https://example.com/news
```

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 25.02.2026)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API (AUTH/RBAC)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ `lib/auth.ts`:
  - `authenticateUser` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π `userId`
  - `authorizeRole` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π
  - `verifyAuth` –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç `x-user-id`, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ JWT
- –£—Å–∏–ª–µ–Ω `middleware.ts`:
  - method-aware –ø—É–±–ª–∏—á–Ω—ã–µ API (`GET /api/tours`, `GET /api/partners`, `GET /api/eco-points`, –ø—É–±–ª–∏—á–Ω—ã–µ `/api/auth`, `/api/weather`)
  - role-based –¥–æ—Å—Ç—É–ø –∫ namespace:
    - `/api/operator/*` ‚Äî `operator`
    - `/api/admin/*` ‚Äî `admin`
    - `/api/guide/*` ‚Äî `guide`
    - `/api/transfer-operator/*` ‚Äî `transfer_operator`
    - `/api/agent/*` ‚Äî `agent`
  - security headers –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö –≤–µ—Ç–∫–∞—Ö –æ—Ç–≤–µ—Ç–æ–≤
  - middleware –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç `X-Auth-Verified` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT

### IDOR hardening
- –î–æ–±–∞–≤–ª–µ–Ω—ã ownership-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥–æ–≤–µ—Ä–∏–µ –∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º `operatorId/userId` –≤ –∫–ª—é—á–µ–≤—ã—Ö GET/PUT/DELETE/POST-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö:
  - `operator/*` (tours, bookings, finance, schedules, publish/deactivate –∏ –¥—Ä.)
  - `bookings/[id]/cancel`
  - `payments/[id]/status`
  - `eco-points/user`
  - `loyalty/stats`
  - `chat`
  - `reviews` (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - `support/tickets/[id]`
  - `engagement/notifications/[id]`
  - `engagement/messages/[id]`

### –ú–ß–°: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø
- –î–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ú–ß–°:
  - API: `GET/POST /api/operator/mchs-registrations`
  - –∫–ª–∏–µ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: `lib/safety/mchs-client.ts`
  - —Ñ–æ—Ä–º–∞ –∏ —Å—Ç–∞—Ç—É—Å –≤ dashboard –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞: `MchsRegistrationPanel`
- –ü–æ–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
  - —Å–æ—Å—Ç–∞–≤ –≥—Ä—É–ø–ø—ã
  - –º–∞—Ä—à—Ä—É—Ç
  - –¥–∞—Ç—ã
  - –∫–æ–Ω—Ç–∞–∫—Ç—ã –≥–∏–¥–∞
  - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü–µ—Ä–µ–±—Ä–æ—Å —Ç—É—Ä–∏—Å—Ç–æ–≤ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω API `app/api/operator/transfer-booking/route.ts`:
  - `POST` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–±—Ä–æ—Å–∞
  - `PATCH` ‚Äî –ø—Ä–∏–Ω—è—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å/–æ—Ç–º–µ–Ω–∏—Ç—å
  - `GET` ‚Äî –≤—Ö–æ–¥—è—â–∏–µ/–∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏:
  - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ —Ç—É—Ä –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –ø–µ—Ä–≤–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (`commission_percent`, `commission_amount`)

### markdown.new –≤ RAG pipeline
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/ai/markdown-new.ts` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ URL –≤ Markdown.
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤:
  - `app/api/ai/knowledge-base/route.ts` (—Ä–µ–∂–∏–º `type=url` + –∞–≤—Ç–æ–æ–±—Ö–æ–¥ URL –∏–∑ env)
  - `scripts/update-knowledge-base.js` (`url <https://...>` –∏ –∞–≤—Ç–æ-—Ä–µ–∂–∏–º)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
kamhub/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API endpoints (tours, operator, transfers)
‚îÇ   ‚îú‚îÄ‚îÄ tours/            # –ö–∞—Ç–∞–ª–æ–≥ –∏ –¥–µ—Ç–∞–ª–∏ —Ç—É—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ hub/              # –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tourist/     # –¢—É—Ä–∏—Å—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guide/       # –ì–∏–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent/       # –ê–≥–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operator/    # –û–ø–µ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transfer-operator/
‚îÇ   ‚îú‚îÄ‚îÄ auth/            # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ accommodations/  # –ñ–∏–ª—å—ë
‚îÇ   ‚îú‚îÄ‚îÄ cars/            # –ê—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ
‚îÇ   ‚îú‚îÄ‚îÄ gear/            # –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ shop/            # –ú–∞–≥–∞–∑–∏–Ω
‚îÇ
‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ admin/           # Admin –ø–∞–Ω–µ–ª—å (DataTable, MetricCard, StatusBadge...)
‚îÇ   ‚îú‚îÄ‚îÄ booking/         # –§–æ—Ä–º—ã –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ home/            # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ weather/         # –ü–æ–≥–æ–¥–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ transfer-operator/
‚îÇ
‚îú‚îÄ‚îÄ lib/                 # –£—Ç–∏–ª–∏—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ ai/              # AI –º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompts.ts       # –†–æ–ª–µ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã + anti-hallucination
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.ts    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ image-tagger.ts  # –ê–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥ —Ñ–æ—Ç–æ (Claude Vision)
‚îÇ   ‚îú‚îÄ‚îÄ recommendations/ # –î–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ engine.ts        # 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: SimilarUsers, Content, EcoOptimized
‚îÇ   ‚îú‚îÄ‚îÄ auth/            # JWT, helpers
‚îÇ   ‚îú‚îÄ‚îÄ database/        # PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ services.ts      # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
‚îÇ
‚îú‚îÄ‚îÄ types/               # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ contexts/            # React Context (Auth, Theme, Role, Orders)
‚îú‚îÄ‚îÄ hooks/               # Custom React —Ö—É–∫–∏
‚îú‚îÄ‚îÄ AGENTS.md            # OpenClaw: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ TOOLS.md             # OpenClaw: –∫–æ–º–∞–Ω–¥—ã –∏ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏
```

> **–ü–∞—Ç—Ç–µ—Ä–Ω —Å—Ç—Ä–∞–Ω–∏—Ü:** `page.tsx` (server + metadata) + `_*Client.tsx` (`'use client'` + –≤—Å—è –ª–æ–≥–∏–∫–∞). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å `'use client'` –∏ `export const metadata` –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.

---

## ü§ñ AI –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (`POST /api/ai/chat`)

–†–æ–ª–µ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç —Å –ø–∞–º—è—Ç—å—é –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –∫–∞–∂–¥—É—é —Ä–æ–ª—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ anti-hallucination.

```json
{
  "message": "–ö–∞–∫–æ–π —Ç—É—Ä –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö?",
  "sessionId": "uuid",
  "role": "tourist",
  "userId": "123"
}
```

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (`GET /api/discovery/semantic-search`)

–ü–æ–∏—Å–∫ –ø–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É —è–∑—ã–∫—É —á–µ—Ä–µ–∑ pgvector. Fallback ‚Üí SQL LIKE.

```bash
GET /api/discovery/semantic-search?q=—Ç—É—Ä+–∫+–≤—É–ª–∫–∞–Ω–∞–º+–¥–ª—è+—Å–µ–º—å–∏+—Å+–¥–µ—Ç—å–º–∏
```

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä—ã:
```bash
npx ts-node scripts/index-tours.ts
```

### –ê–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥ —Ñ–æ—Ç–æ (`POST /api/operator/tours/[id]/generate-tags`)

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—É—Ä–∞ —á–µ—Ä–µ–∑ Claude Vision –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–≥–∏ –≤ `ai_tags` JSONB. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤. –ö–Ω–æ–ø–∫–∞ ¬´–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–≥–∏¬ª –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–∞.

–¢–µ–≥–∏: `landscape`, `activity`, `difficulty`, `season`, `features`

–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—É—Ä–æ–≤ –ø–æ —Ç–µ–≥–∞–º:
```bash
GET /api/discovery/search?landscape=volcano&activity=hiking
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (`GET /api/tourist/recommendations`)

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –õ–æ–≥–∏–∫–∞ |
|-----------|--------|
| `SIMILAR_USERS` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–æ—Ö–æ–∂–µ–π –∏—Å—Ç–æ—Ä–∏–µ–π –±—Ä–æ–Ω–∏—Ä—É—é—Ç... |
| `TOUR_CONTENT` | –ü–æ—Ö–æ–∂–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è / —Ü–µ–Ω–∞ ¬±30% / —Å–ª–æ–∂–Ω–æ—Å—Ç—å |
| `ECO_OPTIMIZED` | –¢—É—Ä—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º eco_points_reward |

–ö—ç—à 24—á –≤ PostgreSQL. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `?refresh=1`

### AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ú–æ–¥–µ–ª—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-----------|--------|---------------|
| DeepSeek | deepseek-chat | –ß–∞—Ç (–æ—Å–Ω–æ–≤–Ω–æ–π) |
| OpenAI | text-embedding-3-small | –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ |
| Anthropic | claude-sonnet-4-6 | –ê–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥ —Ñ–æ—Ç–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) |
| Minimax | abab6.5s-chat | Fallback |
| x.ai | grok-4 | Fallback |

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–•–æ—Å—Ç–∏–Ω–≥:** Timeweb Cloud  
**–ê–¥—Ä–µ—Å:** `8ad609fcbfd2ad0bd069be47.twc1.net`

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (+ `recommendations`, `recommended_at`) |
| `tours` | –¢—É—Ä—ã (+ `embedding vector(1536)`, `ai_tags JSONB`) |
| `partners` | –ü–∞—Ä—Ç–Ω—ë—Ä—ã |
| `bookings` | –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è |
| `transfers` | –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã |
| `chat_sessions` | –ò—Å—Ç–æ—Ä–∏—è AI-–ø–µ—Ä–µ–ø–∏—Å–∫–∏ –ø–æ —Å–µ—Å—Å–∏—è–º |

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ `migrations/`:

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `01_initial_extensions.sql` | –ë–∞–∑–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è |
| `02_support_tables.sql` | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã |
| `03_vector_search.sql` | pgvector + chat_sessions |
| `04_tour_tags.sql` | ai_tags JSONB + GIN –∏–Ω–¥–µ–∫—Å |
| `05_recommendations_cache.sql` | –ö—ç—à —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤ users |
| `017_create_mchs_and_transfer_booking.sql` | –ú–ß–° —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ + –ø–µ—Ä–µ–±—Ä–æ—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ |

---

## üåç –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `tourist` | –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä |
| `operator` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏, —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏, –ú–ß–°, transfer-booking |
| `guide` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –≥—Ä—É–ø–ø—ã, —Ä–µ–ø—É—Ç–∞—Ü–∏—è |
| `transfer_operator` | –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã, –∞–≤—Ç–æ–ø–∞—Ä–∫, –≤–æ–¥–∏—Ç–µ–ª–∏ |
| `agent` | –ö–ª–∏–µ–Ω—Ç—ã, –∫–æ–º–∏—Å—Å–∏–∏, –≤–∞—É—á–µ—Ä—ã |
| `admin` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã |

---

## –ù–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| Endpoint | –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-------|------------|
| `/api/operator/mchs-registrations` | `GET` | –°–ø–∏—Å–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –≤ –ú–ß–° |
| `/api/operator/mchs-registrations` | `POST` | –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ú–ß–° |
| `/api/operator/transfer-booking` | `GET` | –í—Ö–æ–¥—è—â–∏–µ/–∏—Å—Ö–æ–¥—è—â–∏–µ –ø–µ—Ä–µ–±—Ä–æ—Å—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π |
| `/api/operator/transfer-booking` | `POST` | –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–±—Ä–æ—Å–∞ |
| `/api/operator/transfer-booking` | `PATCH` | –ü—Ä–∏–Ω—è—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å/–æ—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ |

## üì± –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

| –ú–∞—Ä—à—Ä—É—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/` | –ì–ª–∞–≤–Ω–∞—è (–ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤) |
| `/tours` | –ö–∞—Ç–∞–ª–æ–≥ —Ç—É—Ä–æ–≤ |
| `/tours/[id]` | –î–µ—Ç–∞–ª–∏ —Ç—É—Ä–∞ |
| `/tours/fishing` | –†—ã–±–∞–ª–∫–∞ |
| `/accommodations` | –ñ–∏–ª—å—ë |
| `/cars` | –ê—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ |
| `/gear` | –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ |
| `/shop` | –ú–∞–≥–∞–∑–∏–Ω |
| `/hub/*` | –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã |
| `/auth/login` | –í—Ö–æ–¥ |
| `/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| `/map` | –ö–∞—Ä—Ç–∞ |

---

## ‚òÅÔ∏è –î–µ–ø–ª–æ–π

### Timeweb Cloud (–æ—Å–Ω–æ–≤–Ω–æ–π)

–ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ `main`. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub Copilot:

```
¬´–ó–∞–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç –≤ Timeweb¬ª
¬´–ü–æ–∫–∞–∂–∏ –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–ø–ª–æ—è¬ª
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP –≤ `.vscode/mcp.json` (–Ω–µ –≤ git).

### Docker

```bash
docker-compose up --build
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm test                   # Vitest (unit —Ç–µ—Å—Ç—ã)
npm run test:coverage      # –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
```

---

## ü§ñ OpenClaw Agent Workspace

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å [OpenClaw](https://openclaw.ai) ‚Äî AI –∞–≥–µ–Ω—Ç–æ–º. –§–∞–π–ª—ã –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| [`AGENTS.md`](AGENTS.md) | –ü—Ä–∞–≤–∏–ª–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ |
| [`TOOLS.md`](TOOLS.md) | –ö–æ–º–∞–Ω–¥—ã, –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏, env vars |

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ OpenClaw —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –∫–∞–∫ workspace –≤ `~/.openclaw/openclaw.json`.

---

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|---------|
| –°–±–æ—Ä–∫–∞ | ‚úÖ passing |
| TypeScript | ‚úÖ –±–µ–∑ –æ—à–∏–±–æ–∫ (strict mode) |
| React Doctor | ‚úÖ 99/100 |
| –§–∞–π–ª–æ–≤ | 580+ |

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ `JWT_SECRET` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ runtime (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç `build`)
- ‚úÖ Server/Client split ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- ‚úÖ `metadata` + `'use client'` –∫–æ–Ω—Ñ–ª–∏–∫—Ç ‚Äî —É—Å—Ç—Ä–∞–Ω—ë–Ω
- ‚úÖ –í—Å–µ TypeScript strict-mode –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### AI —Ñ–∏—á–∏ (–¥–æ–±–∞–≤–ª–µ–Ω—ã 23.02.2026)
- ‚úÖ –†–æ–ª–µ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π AI-—á–∞—Ç —Å –ø–∞–º—è—Ç—å—é 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ Anti-hallucination –ø—Ä–∞–≤–∏–ª–∞ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –¥–ª—è –≤—Å–µ—Ö 6 —Ä–æ–ª–µ–π
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤ (pgvector + embeddings)
- ‚úÖ SQL fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ê–≤—Ç–æ—Ç–µ–≥–≥–∏–Ω–≥ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç—É—Ä–æ–≤ (Claude Vision)
- ‚úÖ –î–≤–∏–∂–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ —á–∏—Å—Ç–æ–º SQL (3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
- ‚úÖ –ö—ç—à —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π 24—á –≤ PostgreSQL
- ‚úÖ –°–µ–∫—Ü–∏—è ¬´–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∞–º¬ª –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ —Ç—É—Ä–∏—Å—Ç–∞

### –ü–∞—Ä—Ç–Ω—ë—Ä—ã

**–ö–∞–º—á–∞—Ç—Å–∫–∞—è –†—ã–±–∞–ª–∫–∞** (fishingkam.ru) ‚Äî 11 —Ç—É—Ä–æ–≤ –≤ –±–∞–∑–µ  
–ö–æ–Ω—Ç–∞–∫—Ç—ã: +7 914-782-22-22, +7 999-299-70-07

---

## üì¶ –°—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| Framework | Next.js 15 (App Router) |
| Language | TypeScript 5.4 (strict) |
| Styling | Tailwind CSS 3.4 |
| Database | PostgreSQL + pgvector |
| Auth | JWT (jose) |
| Validation | Zod |
| Icons | Lucide React |
| Testing | Vitest |
| Monitoring | Sentry |
| Deploy | Timeweb Cloud Apps |
| AI Chat | DeepSeek + Minimax + x.ai |
| AI Vision | Anthropic Claude |
| AI Search | pgvector (IVFFlat, cosine) |

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

Private ‚Äî –≤—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
