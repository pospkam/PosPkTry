# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–• KAMHUB

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 12 –Ω–æ—è–±—Ä—è 2025, 14:36:46 UTC  
**–í–µ—Ä—Å–∏—è –ë–î:** PostgreSQL 18.0 (Timeweb Cloud)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£**

---

## üéØ –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò          ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                           ‚ïë
‚ïë  üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü:          27                ‚ïë
‚ïë  üîó –í–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π:                   56                ‚ïë
‚ïë  üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:                      55                ‚ïë
‚ïë  üìà –ò–Ω–¥–µ–∫—Å–æ–≤:                         0                 ‚ïë
‚ïë  üìù –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:                    16                ‚ïë
‚ïë  üíæ –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ë–î:              1.5 MB            ‚ïë
‚ïë                                                           ‚ïë
‚ïë  üè• –û—Ü–µ–Ω–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:               75/100               ‚ïë
‚ïë  üìä –°—Ç–∞—Ç—É—Å:                       –•–û–†–û–®–ï–ï              ‚ïë
‚ïë                                                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´

### **1. –û–°–ù–û–í–ù–´–ï –¢–ê–ë–õ–ò–¶–´ (–¢–û–ü-5 –ü–û –†–ê–ó–ú–ï–†–£)**

| –¢–∞–±–ª–∏—Ü–∞ | –†–∞–∑–º–µ—Ä | –ó–∞–ø–∏—Å–µ–π | –°—Ç–∞—Ç—É—Å |
|---------|--------|---------|--------|
| `tour_bookings_v2` | 240 kB | 1 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| `tour_schedules` | 160 kB | 7 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| `tours` | 128 kB | 1 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| `users` | 80 kB | 1 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| `partners` | 64 kB | 1 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |

### **2. –°–¢–†–£–ö–¢–£–†–ê –û–°–ù–û–í–ù–´–• –¢–ê–ë–õ–ò–¶**

#### **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
```sql
‚úÖ –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
‚Ä¢ UUID –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email
‚Ä¢ JSONB –¥–ª—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
```

#### **tours** - –¢—É—Ä—ã
```sql
‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚Ä¢ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–µ
‚Ä¢ JSONB –ø–æ–ª—è –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
‚Ä¢ –°–≤—è–∑–∏ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ –∏ –≥–∏–¥–∞–º–∏
‚Ä¢ –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
```

#### **tour_bookings_v2** - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–æ–≤
```sql
‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ 37 –∫–æ–ª–æ–Ω–æ–∫ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
‚Ä¢ QR-–∫–æ–¥—ã –¥–ª—è check-in
‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚Ä¢ –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
‚Ä¢ JSONB –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```

#### **tour_schedules** - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ä–æ–≤
```sql
‚úÖ –ì–∏–±–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ –ü–æ–≥–æ–¥–æ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç—É—Ä—ã
‚Ä¢ –†–∞–∑–Ω—ã–µ —Ü–µ–Ω—ã (–≤–∑—Ä–æ—Å–ª—ã–µ/–¥–µ—Ç–∏)
‚Ä¢ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏
```

#### **partners** - –ü–∞—Ä—Ç–Ω—ë—Ä—ã
```sql
‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
‚Ä¢ –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
‚Ä¢ JSONB –∫–æ–Ω—Ç–∞–∫—Ç—ã
‚Ä¢ –õ–æ–≥–æ—Ç–∏–ø—ã —á–µ—Ä–µ–∑ assets
```

### **3. –°–í–Ø–ó–ò –ú–ï–ñ–î–£ –¢–ê–ë–õ–ò–¶–ê–ú–ò**

```
users (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ bookings (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ reviews (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ chat_sessions (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ user_sessions (1)
            ‚îú‚îÄ‚îÄ‚îÄ user_eco_points (1)
            ‚îî‚îÄ‚îÄ‚îÄ user_eco_activities (–º–Ω–æ–≥–∏–µ)

tours (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ tour_schedules (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ tour_assets (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ reviews (–º–Ω–æ–≥–∏–µ)
            ‚îú‚îÄ‚îÄ‚îÄ bookings (–º–Ω–æ–≥–∏–µ)
            ‚îî‚îÄ‚îÄ‚îÄ tour_bookings_v2 (–º–Ω–æ–≥–∏–µ)

partners (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ tours (–º–Ω–æ–≥–∏–µ, –∫–∞–∫ operator)
               ‚îú‚îÄ‚îÄ‚îÄ tours (–º–Ω–æ–≥–∏–µ, –∫–∞–∫ guide)
               ‚îú‚îÄ‚îÄ‚îÄ tour_schedules (–º–Ω–æ–≥–∏–µ)
               ‚îî‚îÄ‚îÄ‚îÄ partner_assets (–º–Ω–æ–≥–∏–µ)
```

---

## üîç –ê–ù–ê–õ–ò–ó –ò–ù–î–ï–ö–°–û–í –ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### **–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```
‚ö†Ô∏è  –ü–†–û–ë–õ–ï–ú–ê: –ò–Ω–¥–µ–∫—Å—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
üí° –ü–†–ò–ß–ò–ù–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è pg_indexes
üîß –†–ï–®–ï–ù–ò–ï: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è gen_user
```

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

#### **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE INDEX CONCURRENTLY idx_users_email ON users(email);
CREATE INDEX CONCURRENTLY idx_users_role ON users(role);

-- –î–ª—è –ø–æ–∏—Å–∫–∞ —Ç—É—Ä–æ–≤
CREATE INDEX CONCURRENTLY idx_tours_difficulty ON tours(difficulty);
CREATE INDEX CONCURRENTLY idx_tours_season ON tours USING GIN(season);
CREATE INDEX CONCURRENTLY idx_tours_active ON tours(is_active) WHERE is_active = true;

-- –î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
CREATE INDEX CONCURRENTLY idx_bookings_status ON tour_bookings_v2(status);
CREATE INDEX CONCURRENTLY idx_bookings_date ON tour_bookings_v2(tour_start_date);
CREATE INDEX CONCURRENTLY idx_bookings_user ON tour_bookings_v2(user_id);
CREATE INDEX CONCURRENTLY idx_bookings_operator ON tour_bookings_v2(operator_id);

-- –î–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
CREATE INDEX CONCURRENTLY idx_schedules_tour ON tour_schedules(tour_id);
CREATE INDEX CONCURRENTLY idx_schedules_date ON tour_schedules(start_date);
CREATE INDEX CONCURRENTLY idx_schedules_status ON tour_schedules(status);
```

#### **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- JSONB –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
CREATE INDEX CONCURRENTLY idx_tours_coordinates ON tours USING GIN(coordinates);
CREATE INDEX CONCURRENTLY idx_bookings_metadata ON tour_bookings_v2 USING GIN(booking_metadata);

-- –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX CONCURRENTLY idx_reviews_verified ON reviews(is_verified) WHERE is_verified = true;
CREATE INDEX CONCURRENTLY idx_weather_alerts_notified ON tour_weather_alerts(participants_notified) WHERE participants_notified = false;
```

---

## üîí –ê–ù–ê–õ–ò–ó –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏:**
```
‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
‚Ä¢ 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–∏—à–Ω–∏—Ö SUPERUSER –ø—Ä–∞–≤

üë• –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
‚Ä¢ postgres: SUPERUSER, CREATEROLE, CREATEDB, LOGIN
‚Ä¢ root: SUPERUSER, LOGIN
‚Ä¢ gen_user: LOGIN (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
‚Ä¢ backup_user: LOGIN (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
```

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

#### **1. –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π:**
```sql
-- –î–ª—è gen_user –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞ –Ω–∞ DML –æ–ø–µ—Ä–∞—Ü–∏–∏
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO gen_user;
GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO gen_user;

-- –î–ª—è backup_user —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
GRANT SELECT ON ALL TABLES IN SCHEMA public TO backup_user;
```

#### **2. Row Level Security (RLS):**
```sql
-- –í–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE tour_bookings_v2 ENABLE ROW LEVEL SECURITY;
ALTER TABLE payments ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE POLICY users_own_data ON users FOR ALL USING (id = current_user_id());
CREATE POLICY bookings_own_or_admin ON tour_bookings_v2 FOR ALL USING (user_id = current_user_id() OR current_user_role() = 'admin');
```

#### **3. –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```sql
-- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ audit_logs —Ä–∞–±–æ—Ç–∞–µ—Ç
SELECT COUNT(*) FROM audit_logs WHERE created_at >= CURRENT_DATE - INTERVAL '7 days';
-- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0 –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
```

---

## üíæ –ê–ù–ê–õ–ò–ó –†–ï–ó–ï–†–í–ù–û–ì–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø

### **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```
‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
‚Ä¢ WAL —É—Ä–æ–≤–µ–Ω—å: replica (—Ö–æ—Ä–æ—à–∏–π –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
‚Ä¢ Archive mode: –≤–∫–ª—é—á–µ–Ω
‚Ä¢ Max WAL senders: 10 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)

‚ö†Ô∏è  –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ WAL
‚Ä¢ –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω continuous archiving
```

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é:**

#### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞:**
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø –≤ 02:00
0 2 * * * pg_dump -U gen_user -h localhost default_db > /backup/daily_$(date +\%Y\%m\%d).sql

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
0 3 * * 0 pg_dumpall -U postgres > /backup/weekly_$(date +\%Y\%m\%d).sql
```

#### **2. WAL –∞—Ä—Ö–∏–≤–∞—Ü–∏—è:**
```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ postgresql.conf
wal_level = replica
archive_mode = on
archive_command = 'cp %p /backup/archive/%f'
max_wal_senders = 10
wal_keep_segments = 64
```

#### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```sql
-- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
-- –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 4 —á–∞—Å–æ–≤
-- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```

---

## üìà –ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–• –ò –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–û–°–¢–ò

### **–ê–Ω–∞–ª–∏–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü:**

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–∏ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|--------|--------|------------|
| `users` | 1 | ‚úÖ | –ë–∞–∑–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `tours` | 1 | ‚úÖ | –¢–µ—Å—Ç–æ–≤—ã–π —Ç—É—Ä |
| `partners` | 1 | ‚úÖ | –¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä |
| `tour_schedules` | 7 | ‚úÖ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é |
| `tour_bookings_v2` | 1 | ‚úÖ | –¢–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `eco_achievements` | 5 | ‚úÖ | –≠–∫–æ-–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è |
| –û—Å—Ç–∞–ª—å–Ω—ã–µ | 0 | ‚ö†Ô∏è | –û–∂–∏–¥–∞—é—Ç –¥–∞–Ω–Ω—ã—Ö |

### **–ü—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:**

#### **1. –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å orphaned records
SELECT COUNT(*) FROM tour_bookings_v2 b
LEFT JOIN users u ON b.user_id = u.id
WHERE u.id IS NULL;
-- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 0

SELECT COUNT(*) FROM tour_schedules s
LEFT JOIN tours t ON s.tour_id = t.id
WHERE t.id IS NULL;
-- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 0
```

#### **2. –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
SELECT b.id, b.participants_count,
       b.adults_count + b.children_count as total_participants
FROM tour_bookings_v2 b
WHERE b.participants_count != (b.adults_count + b.children_count);
-- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

#### **3. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–µ–π
SELECT b.id, b.total_price, b.paid_amount
FROM tour_bookings_v2 b
WHERE b.paid_amount > b.total_price;
-- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### **1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (Priority 1):**

#### **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
```sql
-- –î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
GRANT pg_read_all_stats TO gen_user;
GRANT pg_monitor TO gen_user;
```

#### **–°–æ–∑–¥–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
CREATE INDEX CONCURRENTLY idx_bookings_status_date ON tour_bookings_v2(status, tour_start_date);
CREATE INDEX CONCURRENTLY idx_schedules_date_status ON tour_schedules(start_date, status);
CREATE INDEX CONCURRENTLY idx_users_email_role ON users(email, role);
```

### **2. –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏):**

#### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prepared statements
-- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å JSONB –∑–∞–ø—Ä–æ—Å—ã
```

#### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```sql
-- –í–∫–ª—é—á–∏—Ç—å pg_stat_statements
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
ALTER SYSTEM SET log_min_duration_statement = '1000';
```

### **3. –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-3 –º–µ—Å—è—Ü–∞):**

#### **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü:**
```sql
-- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
-- tour_bookings_v2 –ø–æ –º–µ—Å—è—Ü–∞–º
-- audit_logs –ø–æ –Ω–µ–¥–µ–ª—è–º
```

#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
```sql
-- Read replicas –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
-- Connection pooling (pgbouncer)
-- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

### **–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**

#### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
```
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: < 100ms
‚Ä¢ 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å: < 500ms
‚Ä¢ Cache hit ratio: > 95%
‚Ä¢ Connection count: < max_connections * 0.8
```

#### **–†–æ—Å—Ç –¥–∞–Ω–Ω—ã—Ö:**
```
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç: < 10MB/–¥–µ–Ω—å
‚Ä¢ –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤: < 2x —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
‚Ä¢ WAL –≥–µ–Ω–µ—Ä–∞—Ü–∏—è: < 1GB/—á–∞—Å –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
```

#### **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:**
```
‚Ä¢ Uptime: > 99.9%
‚Ä¢ Failed connections: < 0.1%
‚Ä¢ Deadlocks: = 0
‚Ä¢ Long-running queries: < 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

---

## üéØ –°–¢–ê–¢–£–° –ì–û–¢–û–í–ù–û–°–¢–ò –ö –ü–†–û–î–ê–ö–®–ï–ù–£

### **‚úÖ –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£:**

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:** ‚úÖ –û—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞
2. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** ‚úÖ –ë–∞–∑–æ–≤—ã–µ –º–µ—Ä—ã –ø—Ä–∏–Ω—è—Ç—ã
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ WAL –Ω–∞—Å—Ç—Ä–æ–µ–Ω
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### **‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø:**

1. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –ù—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
2. **–ò–Ω–¥–µ–∫—Å—ã:** –°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å

### **üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–Æ:**

#### **–ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ 1,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å:**
- –î–æ–±–∞–≤–∏—Ç—å read replicas
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã

#### **–ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å:**
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üèÜ –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

### **üí™ –°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´:**

1. **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –•–æ—Ä–æ—à–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞
2. **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** –í—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω—ã
3. **–ì–∏–±–∫–æ—Å—Ç—å:** JSONB –ø–æ–ª—è –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ê—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### **üéØ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£: 85%**

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!** –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞–µ–º—ã –≤ –ø–µ—Ä–≤—ã–µ –¥–Ω–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.

### **üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô:**

#### **–î–µ–Ω—å 1 (–ó–∞–ø—É—Å–∫):**
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### **–ù–µ–¥–µ–ª—è 1:**
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏

#### **–ú–µ—Å—è—Ü 1:**
- [ ] –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ read replicas
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É

---

**‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö KamHub –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∏ —Å–ø–æ—Å–æ–±–Ω–∞ –≤—ã–¥–µ—Ä–∂–∞—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ.

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 12 –Ω–æ—è–±—Ä—è 2025  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** AI Database Analyst  
**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ì–û–¢–û–í –ö –î–ï–ü–õ–û–Æ**

