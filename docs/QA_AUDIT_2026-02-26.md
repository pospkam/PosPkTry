# QA Audit â€” Full Route Check (2026-02-26)

## Kontekst

Cel: proverit' kazhdyj marshrut vo vsekh 6 rolyakh.
Zafiksirovat': chto rabotaet, chto 404, chto padaet, chto pustoye.

Metod: `curl` HTTP status + proverka tela otveta na oshibki.
Dev server: `npm run dev` na `localhost:3000`.
Autentifikaciya: vse hub-marshruty korrektno vozvrashchayut 307 redirect na /auth/login (middleware rabotaet).

---

## 1. CRITICAL (ERROR, unexpected 404)

| Route | Status | Issue |
|-------|--------|-------|
| `/search` | 404 | **Stranica ne sushchestvuet** -- net `app/search/page.tsx`. AGENTS.md ukazyvaet etot marshrut. |
| `/ai-assistant` | 404 | **Stranica ne sushchestvuet** -- net `app/ai-assistant/page.tsx`. AGENTS.md ukazyvaet etot marshrut. |
| `/safety` | 404 | **Stranica ne sushchestvuet** -- net `app/safety/page.tsx`. AGENTS.md ukazyvaet etot marshrut. (est' `/hub/safety`) |
| `/eco` | 404 | **Stranica ne sushchestvuet** -- net `app/eco/page.tsx`. AGENTS.md ukazyvaet etot marshrut. |
| `GET /api/eco-points` | 500 | **Server crash**: `column "name" does not exist` -- SQL oshibka v tablice eco-points. |
| `GET /api/discovery/tours` | 401 | Trebuyetsya auth, no po AGENTS.md eto publichnyi endpoint. |
| `GET /api/health` | 401 | Health-check trebuyetsya auth -- dolzhen byt' publichnyi. |

### Otsutstvuyushchie stranicy iz AGENTS.md (zayavleny, no net page.tsx)

| Expected Route | Status | Actual File Exists |
|----------------|--------|--------------------|
| `/search` | 404 | NO |
| `/ai-assistant` | 404 | NO |
| `/safety` | 404 | NO (est' `/hub/safety`) |
| `/eco` | 404 | NO |
| `/hub/tourist/wishlist` | 307->404 | NO |
| `/hub/tourist/reviews` | 307->404 | NO |
| `/hub/tourist/eco-points` | 307->404 | NO |
| `/hub/tourist/profile` | 307->404 | NO |
| `/hub/tourist/notifications` | 307->404 | NO |
| `/hub/operator/guides` | 307->404 | NO |
| `/hub/operator/analytics` | 307->404 | NO |
| `/hub/operator/finances` | 307->404 | NO (est' `/hub/operator/finance`) |
| `/hub/operator/notifications` | 307->404 | NO |
| `/hub/operator/mchs` | 307->404 | NO (API est', UI net) |
| `/hub/guide/profile` | 307->404 | NO |
| `/hub/guide/reviews` | 307->404 | NO |
| `/hub/transfer-operator/routes` | 307->404 | NO |
| `/hub/transfer-operator/bookings` | 307->404 | NO |
| `/hub/agent/stats` | 307->404 | NO |
| `/hub/admin/tours` | 307->404 | NO (est' `/hub/admin/content/tours`) |
| `/hub/admin/operators` | 307->404 | NO |
| `/hub/admin/bookings` | 307->404 | NO |
| `/hub/admin/moderation` | 307->404 | NO |

---

## 2. PUBLIC PAGES

| Route | HTTP | Status | Notes |
|-------|------|--------|-------|
| `/` | 200 | OK | Homepage zagruzhaetsya, hero gradient, tour cards |
| `/tours` | 200 | OK | Katalog turov, filtry, pustoy spisok (net dannyh v DB) |
| `/tours/fishing` | 200 | OK | 11 turov Kamchatskaya Rybalka (hardcoded data) |
| `/tours/[id]` | 200 | OK | Dinamicheskaya stranica tura |
| `/auth/login` | 200 | OK | Forma vhoda, 3 shaga registracii |
| `/auth/register` | 200 | OK | Forma registracii |
| `/auth/register/operator` | 200 | OK | Registraciya operatora |
| `/map` | 200 | OK | Karta (trebuet Yandex Maps API key) |
| `/shop` | 200 | OK | Magazin suvenirov |
| `/gear` | 200 | OK | Arenda snaryazheniya |
| `/cars` | 200 | OK | Arenda avtomobiley |
| `/partner/register` | 200 | OK | Registraciya partnera |
| `/partner/dashboard` | 200 | OK | Dashboard partnera |
| `/api-docs` | 200 | OK | Swagger UI |
| `/legal/terms` | 200 | OK | Usloviya |
| `/legal/privacy` | 200 | OK | Konfidencial'nost' |
| `/legal/offer` | 200 | OK | Oferta |
| `/legal/commission` | 200 | OK | Komissii |
| `/profile` | 307 | REDIRECT | Pravilnyy redirect na login |
| `/admin/login` | 200 | OK | Admin login page |
| `/admin/settings` | 200 | OK | Admin settings |
| `/search` | 404 | MISSING | **Net page.tsx** |
| `/ai-assistant` | 404 | MISSING | **Net page.tsx** |
| `/safety` | 404 | MISSING | **Net page.tsx** (est' /hub/safety) |
| `/eco` | 404 | MISSING | **Net page.tsx** |

---

## 3. PROTECTED HUB PAGES (all return 307 to /auth/login correctly)

### Tourist (3 stranicy sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/tourist` | YES | REDIRECT (korrektno) |
| `/hub/tourist/bookings` | YES | REDIRECT (korrektno) |
| `/hub/tourist/bookings/new` | YES | REDIRECT (korrektno) |
| `/hub/tourist/wishlist` | NO | 307 -> budet 404 posle logina |
| `/hub/tourist/reviews` | NO | 307 -> budet 404 posle logina |
| `/hub/tourist/eco-points` | NO | 307 -> budet 404 posle logina |
| `/hub/tourist/profile` | NO | 307 -> budet 404 posle logina |
| `/hub/tourist/notifications` | NO | 307 -> budet 404 posle logina |

### Operator (11 stranic sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/operator` | YES | REDIRECT (korrektno) |
| `/hub/operator/tours` | YES | REDIRECT (korrektno) |
| `/hub/operator/tours/new` | YES | REDIRECT (korrektno) |
| `/hub/operator/tours/[id]` | YES | REDIRECT (korrektno) |
| `/hub/operator/bookings` | YES | REDIRECT (korrektno) |
| `/hub/operator/calendar` | YES | REDIRECT (korrektno) |
| `/hub/operator/clients` | YES | REDIRECT (korrektno) |
| `/hub/operator/finance` | YES | REDIRECT (korrektno) |
| `/hub/operator/integrations` | YES | REDIRECT (korrektno) |
| `/hub/operator/reports` | YES | REDIRECT (korrektno) |
| `/hub/operator/transfer` | YES | REDIRECT (korrektno) |
| `/hub/operator/guides` | NO | 307 -> budet 404 posle logina |
| `/hub/operator/analytics` | NO | 307 -> budet 404 posle logina |
| `/hub/operator/finances` | NO | 307 -> /finance rabotaet |
| `/hub/operator/notifications` | NO | 307 -> budet 404 posle logina |
| `/hub/operator/mchs` | NO | 307 -> budet 404 (API est', stranicy net) |

### Guide (4 stranicy sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/guide` | YES | REDIRECT (korrektno) |
| `/hub/guide/schedule` | YES | REDIRECT (korrektno) |
| `/hub/guide/groups` | YES | REDIRECT (korrektno) |
| `/hub/guide/earnings` | YES | REDIRECT (korrektno) |
| `/hub/guide/profile` | NO | 307 -> budet 404 posle logina |
| `/hub/guide/reviews` | NO | 307 -> budet 404 posle logina |

### Transfer Operator (3 stranicy sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/transfer-operator` | YES | REDIRECT (korrektno) |
| `/hub/transfer-operator/vehicles` | YES | REDIRECT (korrektno) |
| `/hub/transfer-operator/drivers` | YES | REDIRECT (korrektno) |
| `/hub/transfer-operator/routes` | NO | 307 -> budet 404 posle logina |
| `/hub/transfer-operator/bookings` | NO | 307 -> budet 404 posle logina |

### Agent (5 stranic sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/agent` | YES | REDIRECT (korrektno) |
| `/hub/agent/clients` | YES | REDIRECT (korrektno) |
| `/hub/agent/bookings` | YES | REDIRECT (korrektno) |
| `/hub/agent/vouchers` | YES | REDIRECT (korrektno) |
| `/hub/agent/commissions` | YES | REDIRECT (korrektno) |
| `/hub/agent/stats` | NO | 307 -> budet 404 posle logina |

### Admin (7 stranic sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/admin` | YES | REDIRECT (korrektno) |
| `/hub/admin/users` | YES | REDIRECT (korrektno) |
| `/hub/admin/content/tours` | YES | REDIRECT (korrektno) |
| `/hub/admin/content/reviews` | YES | REDIRECT (korrektno) |
| `/hub/admin/content/partners` | YES | REDIRECT (korrektno) |
| `/hub/admin/finance` | YES | REDIRECT (korrektno) |
| `/hub/admin/settings` | YES | REDIRECT (korrektno) |
| `/hub/admin/tours` | NO | 307 -> budet 404 (pravilnyi: /content/tours) |
| `/hub/admin/operators` | NO | 307 -> budet 404 posle logina |
| `/hub/admin/bookings` | NO | 307 -> budet 404 posle logina |
| `/hub/admin/moderation` | NO | 307 -> budet 404 posle logina |

### Other Hub Pages (9 stranic sushchestvuyut)

| Route | File Exists | Status |
|-------|-------------|--------|
| `/hub/stay` | YES | REDIRECT (korrektno) |
| `/hub/stay-provider` | YES | REDIRECT (korrektno) |
| `/hub/souvenirs` | YES | REDIRECT (korrektno) |
| `/hub/gear` | YES | REDIRECT (korrektno) |
| `/hub/gear-provider` | YES | REDIRECT (korrektno) |
| `/hub/cars` | YES | REDIRECT (korrektno) |
| `/hub/tours` | YES | REDIRECT (korrektno) |
| `/hub/transfer` | YES | REDIRECT (korrektno) |
| `/hub/safety` | YES | REDIRECT (korrektno) |

---

## 4. API ENDPOINTS

| Endpoint | HTTP | Status | Notes |
|----------|------|--------|-------|
| `GET /api/tours` | 200 | OK | Vozvrashchaet `{"success":true,"data":{"tours":[]}}` (pust, net dannyh) |
| `GET /api/discovery/tours` | 401 | ERROR | Trebuyetsya auth, no dolzhen byt' publichnyi |
| `GET /api/weather` | 400 | OK | Korrektno trebuyetsya lat/lon parametry |
| `GET /api/auth/me` | 401 | OK | Korrektno trebuyetsya auth |
| `GET /api/health` | 401 | ERROR | Health-check ne dolzhen trebovat' auth |
| `GET /api/eco-points` | 500 | CRASH | `column "name" does not exist` -- SQL oshibka |

---

## 5. SVODKA

### Statistika

| Kategoriya | Kolichestvo |
|-----------|------------|
| Stranicy sushchestvuyut (page.tsx) | 66 |
| Publichnye OK (200) | 18 |
| Publichnye 404 (net page.tsx) | 4 |
| Hub stranicy s redirect (307) | 42+ |
| Hub marshrut zayavleny v zadache, no net page.tsx | 22 |
| API 500 crash | 1 |
| API unexpected 401 | 2 |

### Prioritet ispravleniy

**P0 -- Critical (polzovatel'skiy impakt):**

1. `/search` -- 404. Klyuchevoy marshrut iz navigacii, ukazan v AGENTS.md. Nuzhna stranica.
2. `/safety` -- 404. Safety-first platforma, a stranica bezopasnosti 404. (Est' `/hub/safety` no publichnyi marshrut otsutstvuet)
3. `GET /api/eco-points` -- 500. SQL crash, column "name" ne sushchestvuet.
4. `GET /api/health` -- 401. Health-check endpoint trebuyetsya auth -- dolzhen byt' publichnyi.

**P1 -- High (operator/guide impakt):**

5. `/hub/operator/mchs` -- API est', UI stranica otsutstvuet.
6. `/hub/operator/guides` -- otsutstvuet (sidebar ne ssylaetsya, no zayavlena).
7. `/ai-assistant` -- 404. Ukazan v navigacii.
8. `/eco` -- 404. Ukazan v navigacii.

**P2 -- Medium (nedostayushchie stranicy dlya polnoty):**

9. `/hub/tourist/wishlist`, `/reviews`, `/eco-points`, `/profile`, `/notifications` -- 5 stranic turista.
10. `/hub/guide/profile`, `/reviews` -- 2 stranicy gida.
11. `/hub/transfer-operator/routes`, `/bookings` -- 2 stranicy transfer-operatora.
12. `/hub/agent/stats` -- 1 stranica agenta.
13. `/hub/admin/operators`, `/bookings`, `/moderation` -- 3 stranicy admina.
14. `/hub/operator/analytics`, `/notifications` -- 2 stranicy operatora.

**P3 -- Low (kosmetika):**

15. `GET /api/discovery/tours` -- trebuyet auth, a po logike publichnyi.
16. Zamechanie: `/hub/operator/finances` vs `/hub/operator/finance` -- raznyye nazvaniya v zadache i v kode.
17. Zamechanie: `/hub/admin/tours` vs `/hub/admin/content/tours` -- raznyye puti.

---

## 6. PLAN ISPRAVLENIY (NE PRIMENYAT' -- TOLKO PLAN)

### P0 fixes

1. **`/search`**: sozdat' `app/search/page.tsx` -- redirect na `/tours?search=` ili otdel'naya stranica poiska.
2. **`/safety`**: sozdat' `app/safety/page.tsx` -- proxy na `/hub/safety` ili otdel'naya publichnaya stranica.
3. **`/api/eco-points`**: ispravit' SQL zapros -- column "name" ne sushchestvuet v tablice.
4. **`/api/health`**: sdelat' publichnyi (udalit' auth check).

### P1 fixes

5. **`/hub/operator/mchs`**: sozdat' `app/hub/operator/mchs/page.tsx` -- UI dlya MCHS registracii.
6. **`/ai-assistant`**: sozdat' `app/ai-assistant/page.tsx` -- chat interface.
7. **`/eco`**: sozdat' `app/eco/page.tsx` -- eco-points dashboard.

### P2 fixes

8-14. Sozdat' nedostayushchie stranicy po odnomu shablon na kazhdyj razdel.

---

## Tekhnicheskiye detali

- Dev server: Next.js 15.5.10 na `localhost:3000`
- Middleware: korrektno redirectit `/hub/*` i `/profile` na `/auth/login`
- Vsego v fayl-sisteme: 66 page.tsx faylov
- Vsego zayavleno v zadache: ~55 marshrutov
- Sovpadayut: 33 marshruta
- Otsutstvuyut v fayl-sisteme: 22 marshruta

> Audit zavershen. Nichego ne ispravlyalos' -- tolko diagnostika.
> Data: 2026-02-26
