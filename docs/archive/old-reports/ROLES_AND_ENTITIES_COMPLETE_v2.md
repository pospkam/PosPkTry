# üèóÔ∏è –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –í–°–ï–• –†–û–õ–ï–ô –ò –°–£–©–ù–û–°–¢–ï–ô KAMHUB

**–î–∞—Ç–∞:** 28 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 2.0 (–ü–æ–ª–Ω–∞—è –∏ –¥–µ—Ç–∞–ª—å–Ω–∞—è)  
**–°—Ç–∞—Ç—É—Å:** Comprehensive Documentation

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#—Ä–æ–ª–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
2. [üì¶ –°—É—â–Ω–æ—Å—Ç–∏ (Entities)](#—Å—É—â–Ω–æ—Å—Ç–∏-entities)
3. [üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏](#—Å–≤—è–∑–∏-–º–µ–∂–¥—É-—Å—É—â–Ω–æ—Å—Ç—è–º–∏)
4. [üìä –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö](#–¥–∏–∞–≥—Ä–∞–º–º—ã-–ø–æ—Ç–æ–∫–æ–≤-–¥–∞–Ω–Ω—ã—Ö)
5. [üîê Permissions & Access Control](#permissions--access-control)
6. [üíæ Database Schema](#database-schema)

---

# üë• –†–û–õ–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô

## –ò–ï–†–ê–†–•–ò–Ø –†–û–õ–ï–ô

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô KAMHUB            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ   SUPER_ADMIN (root access)             ‚îÇ
‚îÇ       ‚Üì                                  ‚îÇ
‚îÇ   ADMIN (platform management)           ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ OPERATOR (tour providers)     ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ AGENT (sales partners)        ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ TRANSFER (transport ops)      ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ GUIDE (tour guides)           ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ   TOURIST (end users)                   ‚îÇ
‚îÇ   PARTNER (multiple types)              ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1Ô∏è‚É£ TOURIST (üß≥ –¢—É—Ä–∏—Å—Ç)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ö–æ–Ω–µ—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–æ–≤.

### Permissions
```
READ:   Tours, Reviews, Weather, FAQ
WRITE:  Bookings, Reviews, ProfileData
DELETE: OwnBookings, OwnReviews
UPDATE: OwnProfile, Preferences, Password
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç—É—Ä–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—É—Ä–æ–≤
- ‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–æ–≤
- ‚úÖ –û–ø–ª–∞—Ç–∞ —Ç—É—Ä–æ–≤
- ‚úÖ –û—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏
- ‚úÖ –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–∞–ª–ª—ã (eco-points)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ AI-—á–∞—Ç –ø–æ–º–æ—â–Ω–∏–∫
- ‚úÖ –ü–æ–≥–æ–¥–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ –í–∞—É—á–µ—Ä—ã –∏ —Å–∫–∏–¥–∫–∏

### Related Entities
```
User ‚Üí Booking ‚Üí Tour
User ‚Üí Review ‚Üí Tour
User ‚Üí LoyaltyProfile
User ‚Üí EcoPoints
User ‚Üí Preferences
User ‚Üí PaymentMethod
```

### Dashboard
**URL:** `/hub/tourist` –∏–ª–∏ `/dashboard/tourist`

**–†–∞–∑–¥–µ–ª—ã:**
- My Bookings (–º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- My Reviews (–º–æ–∏ –æ—Ç–∑—ã–≤—ã)
- Loyalty Points (–±–∞–ª–ª—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
- Eco Points (—ç–∫–æ-–±–∞–ª–ª—ã)
- Payment Methods (—Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã)
- Profile Settings (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è)

### API Endpoints
```
# Tours
GET    /api/tourist/tours
GET    /api/tourist/tours/[id]
GET    /api/tourist/tours/search
GET    /api/tourist/tours/recommendations

# Bookings
GET    /api/tourist/bookings
POST   /api/tourist/bookings
GET    /api/tourist/bookings/[id]
PATCH  /api/tourist/bookings/[id]
DELETE /api/tourist/bookings/[id]
POST   /api/tourist/bookings/[id]/cancel

# Reviews
GET    /api/tourist/reviews
POST   /api/tourist/reviews
PATCH  /api/tourist/reviews/[id]
DELETE /api/tourist/reviews/[id]

# Loyalty & Eco
GET    /api/tourist/loyalty/profile
GET    /api/tourist/loyalty/points
GET    /api/tourist/eco-points
POST   /api/tourist/eco-points/log-activity

# Payments
GET    /api/tourist/payments
POST   /api/tourist/payments
GET    /api/tourist/payment-methods

# Profile
GET    /api/tourist/profile
PATCH  /api/tourist/profile
GET    /api/tourist/preferences
PATCH  /api/tourist/preferences
```

### Database Tables
- `users` (role: 'tourist')
- `user_profiles`
- `bookings`
- `reviews`
- `user_loyalty`
- `user_eco_points`
- `user_preferences`
- `payment_methods`

---

## 2Ô∏è‚É£ OPERATOR (üéØ –¢—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ö–æ–º–ø–∞–Ω–∏—è, –æ—Ä–≥–∞–Ω–∏–∑—É—é—â–∞—è —Ç—É—Ä—ã. –°–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—É—Ä–∞–º–∏, —Å–ª–µ–¥–∏—Ç –∑–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏.

### Permissions
```
READ:   OwnTours, OwnBookings, OwnReviews, Finance
WRITE:  Tours, Prices, Descriptions
DELETE: OwnTours (–µ—Å–ª–∏ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π)
UPDATE: OwnTours, Availability, Schedule
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω –∏ —Å–∫–∏–¥–æ–∫
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∏–¥–∞–º–∏
- ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏

### Related Entities
```
Operator ‚Üí Tours (1:M)
Operator ‚Üí Bookings (1:M, —á–µ—Ä–µ–∑ tours)
Operator ‚Üí OperatorMetrics
Operator ‚Üí FinanceData
Operator ‚Üí Guides (1:M)
Operator ‚Üí Assets (logos, images)
```

### Dashboard
**URL:** `/hub/operator` –∏–ª–∏ `/dashboard/operator`

**–†–∞–∑–¥–µ–ª—ã:**
- Overview (–æ–±–∑–æ—Ä)
- Tours Management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏)
- Bookings Calendar (–∫–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π)
- Customers (–∫–ª–∏–µ–Ω—Ç—ã)
- Finance (—Ñ–∏–Ω–∞–Ω—Å—ã)
- Reports & Analytics (–æ—Ç—á–µ—Ç—ã)
- Settings (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

### API Endpoints
```
# Dashboard
GET    /api/operator/dashboard
GET    /api/operator/dashboard/summary
GET    /api/operator/dashboard/metrics

# Tours
GET    /api/operator/tours
POST   /api/operator/tours
GET    /api/operator/tours/[id]
PATCH  /api/operator/tours/[id]
DELETE /api/operator/tours/[id]
POST   /api/operator/tours/[id]/publish
POST   /api/operator/tours/[id]/unpublish

# Tour Scheduling
GET    /api/operator/tours/[id]/schedule
POST   /api/operator/tours/[id]/schedule
PATCH  /api/operator/tours/[id]/schedule/[scheduleId]
DELETE /api/operator/tours/[id]/schedule/[scheduleId]

# Bookings
GET    /api/operator/bookings
GET    /api/operator/bookings/[id]
PATCH  /api/operator/bookings/[id]/status
POST   /api/operator/bookings/[id]/confirm
POST   /api/operator/bookings/[id]/cancel

# Calendar
GET    /api/operator/calendar
GET    /api/operator/calendar/[dateRange]

# Finance
GET    /api/operator/finance/summary
GET    /api/operator/finance/transactions
GET    /api/operator/finance/payouts
GET    /api/operator/finance/revenue

# Guides
GET    /api/operator/guides
POST   /api/operator/guides
GET    /api/operator/guides/[id]
PATCH  /api/operator/guides/[id]

# Analytics
GET    /api/operator/analytics/bookings
GET    /api/operator/analytics/revenue
GET    /api/operator/analytics/customer-insights
GET    /api/operator/analytics/review-insights

# Files
POST   /api/operator/tours/[id]/upload-images
DELETE /api/operator/tours/[id]/images/[imageId]
```

### Database Tables
- `users` (role: 'operator')
- `partners` (type: 'operator')
- `tours`
- `tour_schedules`
- `bookings`
- `reviews`
- `operator_metrics`
- `finance_data`
- `guide_assignments`
- `assets` (tour images, logos)

---

## 3Ô∏è‚É£ GUIDE (üéì –ì–∏–¥/–ü—Ä–æ–≤–æ–¥–Ω–∏–∫)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥, –ø—Ä–æ–≤–æ–¥—è—â–∏–π —Ç—É—Ä—ã –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≥—Ä—É–ø–ø–∞–º–∏.

### Permissions
```
READ:   OwnSchedule, OwnGroups, OwnEarnings
WRITE:  GroupNotes, SafetyReports
UPDATE: OwnProfile
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π
- ‚úÖ –û—Ç—á–µ—Ç—ã –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ª–æ–≥–∏
- ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö
- ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç—ã –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- ‚úÖ –§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Ç—É—Ä–æ–≤
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Ä–∞–±–æ—Ç–∫–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—É—Ä–æ–≤
- ‚úÖ –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –º–æ–±–∏–ª—å–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### Related Entities
```
Guide ‚Üí GuideSchedule (1:M)
Guide ‚Üí GuideGroup (1:M)
Guide ‚Üí GuideEarnings
Guide ‚Üí SafetyReport (1:M)
Guide ‚Üí Equipment (M:M)
Guide ‚Üí Tours (M:M)
```

### Dashboard
**URL:** `/hub/guide` –∏–ª–∏ `/mobile/guide`

**–†–∞–∑–¥–µ–ª—ã:**
- My Schedule (–º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
- Active Tour (—Ç–µ–∫—É—â–∏–π —Ç—É—Ä)
- Group Management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π)
- Safety Reports (–æ—Ç—á–µ—Ç—ã –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- Equipment Checklist (—á–µ–∫-–ª–∏—Å—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è)
- Earnings (–∑–∞—Ä–∞–±–æ—Ç–æ–∫)
- Statistics (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

### Mobile App Features
- Offline access to tour details
- GPS tracking
- Emergency alerts
- Photo uploads
- Communication with tourists

### API Endpoints
```
# Schedule
GET    /api/guide/schedule
GET    /api/guide/schedule/[dateRange]
GET    /api/guide/schedule/[tourId]

# Current Tour
GET    /api/guide/current-tour
PATCH  /api/guide/current-tour/status
POST   /api/guide/current-tour/checkin
POST   /api/guide/current-tour/checkout

# Groups
GET    /api/guide/groups
GET    /api/guide/groups/[groupId]
PATCH  /api/guide/groups/[groupId]
POST   /api/guide/groups/[groupId]/notes
GET    /api/guide/groups/[groupId]/participants

# Safety
POST   /api/guide/safety-reports
GET    /api/guide/safety-reports
GET    /api/guide/emergency-contacts

# Equipment
GET    /api/guide/equipment
POST   /api/guide/equipment/checklist
PATCH  /api/guide/equipment/checklist/[checklistId]

# Earnings
GET    /api/guide/earnings
GET    /api/guide/earnings/[period]
GET    /api/guide/payouts

# Statistics
GET    /api/guide/stats
GET    /api/guide/stats/tours-conducted
GET    /api/guide/stats/rating

# Media
POST   /api/guide/tours/[tourId]/photos
POST   /api/guide/tours/[tourId]/videos
```

### Database Tables
- `users` (role: 'guide')
- `guide_schedules`
- `guide_groups`
- `guide_earnings`
- `safety_reports`
- `equipment_checklist`
- `guide_tour_assignments`

---

## 4Ô∏è‚É£ TRANSFER OPERATOR (üöó –û–ø–µ—Ä–∞—Ç–æ—Ä —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ö–æ–º–ø–∞–Ω–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —É—Å–ª—É–≥–∏ (—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã, –∞—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ, –≤–µ—Ä—Ç–æ–ª–µ—Ç—ã –∏ —Ç.–¥.)

### Permissions
```
READ:   OwnVehicles, OwnDrivers, OwnBookings, Finance
WRITE:  Vehicles, Drivers, Routes, Schedules
UPDATE: OwnData
DELETE: OwnData (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
- ‚úÖ GPS-–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
- ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç
- ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–µ–∑–¥–æ–∫

### Related Entities
```
TransferOperator ‚Üí Vehicles (1:M)
TransferOperator ‚Üí Drivers (1:M)
TransferOperator ‚Üí TransferRoutes (1:M)
TransferOperator ‚Üí TransferBookings (1:M)
TransferOperator ‚Üí TransferMetrics
Drivers ‚Üí Vehicles (M:M)
```

### Dashboard
**URL:** `/hub/transfer-operator` –∏–ª–∏ `/hub/transfer`

**–†–∞–∑–¥–µ–ª—ã:**
- Overview (–æ–±–∑–æ—Ä)
- Vehicles (–∞–≤—Ç–æ–ø–∞—Ä–∫)
- Drivers (–≤–æ–¥–∏—Ç–µ–ª–∏)
- Routes (–º–∞—Ä—à—Ä—É—Ç—ã)
- Bookings (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- GPS Tracking (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ)
- Finance (—Ñ–∏–Ω–∞–Ω—Å—ã)
- Documents (–¥–æ–∫—É–º–µ–Ω—Ç—ã)

### API Endpoints
```
# Dashboard
GET    /api/transfer/dashboard
GET    /api/transfer/dashboard/metrics

# Vehicles
GET    /api/transfer/vehicles
POST   /api/transfer/vehicles
GET    /api/transfer/vehicles/[id]
PATCH  /api/transfer/vehicles/[id]
DELETE /api/transfer/vehicles/[id]
PATCH  /api/transfer/vehicles/[id]/status
GET    /api/transfer/vehicles/[id]/maintenance-history

# Drivers
GET    /api/transfer/drivers
POST   /api/transfer/drivers
GET    /api/transfer/drivers/[id]
PATCH  /api/transfer/drivers/[id]
DELETE /api/transfer/drivers/[id]
PATCH  /api/transfer/drivers/[id]/status
PATCH  /api/transfer/drivers/[id]/certification
GET    /api/transfer/drivers/[id]/trips

# Routes
GET    /api/transfer/routes
POST   /api/transfer/routes
GET    /api/transfer/routes/[id]
PATCH  /api/transfer/routes/[id]
DELETE /api/transfer/routes/[id]
GET    /api/transfer/routes/popular

# Schedules
GET    /api/transfer/schedules
POST   /api/transfer/schedules
PATCH  /api/transfer/schedules/[id]
DELETE /api/transfer/schedules/[id]

# Bookings
GET    /api/transfer/bookings
GET    /api/transfer/bookings/[id]
PATCH  /api/transfer/bookings/[id]/status

# GPS Tracking
GET    /api/transfer/tracking/[vehicleId]
GET    /api/transfer/tracking/trip/[tripId]
POST   /api/transfer/tracking/update-location

# Finance
GET    /api/transfer/finance/summary
GET    /api/transfer/finance/revenue
GET    /api/transfer/finance/expenses

# Documents
GET    /api/transfer/documents
POST   /api/transfer/documents
DELETE /api/transfer/documents/[id]
```

### Database Tables
- `users` (role: 'transfer')
- `partners` (type: 'transfer')
- `vehicles`
- `drivers`
- `driver_vehicles` (M:M)
- `transfer_routes`
- `transfer_schedules`
- `transfer_bookings`
- `gps_tracking`
- `maintenance_records`

---

## 5Ô∏è‚É£ AGENT (üé´ –ê–≥–µ–Ω—Ç/–†–µ—Ñ–µ—Ä–∞–ª)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–∞—Ä—Ç–Ω–µ—Ä, –ø—Ä–∏–≤–ª–µ–∫–∞—é—â–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∞—é—â–∏–π –∫–æ–º–∏—Å—Å–∏–∏. –ú–æ–∂–µ—Ç –±—ã—Ç—å —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ, –æ—Ç–µ–ª—å –∏–ª–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä.

### Permissions
```
READ:   OwnClients, OwnBookings, OwnCommissions
WRITE:  Clients, Bookings (–æ—Ç –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞), Vouchers
UPDATE: OwnData
DELETE: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –æ—Ç –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—É—á–µ—Ä–∞–º–∏/–∫—É–ø–æ–Ω–∞–º–∏
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã—Ö
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- ‚úÖ –í—ã–ø–ª–∞—Ç—ã
- ‚úÖ –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∞–º–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

### Related Entities
```
Agent ‚Üí AgentClients (1:M)
Agent ‚Üí Bookings (1:M, created by agent)
Agent ‚Üí Vouchers (1:M)
Agent ‚Üí AgentCommissions
Agent ‚Üí CommissionPayouts (1:M)
Agent ‚Üí AgentMetrics
```

### Dashboard
**URL:** `/hub/agent` –∏–ª–∏ `/dashboard/agent`

**–†–∞–∑–¥–µ–ª—ã:**
- My Clients (–º–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã)
- My Bookings (–º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- Commissions (–∫–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–µ)
- Vouchers (–≤–∞—É—á–µ—Ä—ã)
- Payouts (–≤—ã–ø–ª–∞—Ç—ã)
- Referrals (—Ä–µ—Ñ–µ—Ä–∞–ª—ã)
- Analytics (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- Reports (–æ—Ç—á–µ—Ç—ã)

### API Endpoints
```
# Dashboard
GET    /api/agent/dashboard
GET    /api/agent/dashboard/summary

# Clients
GET    /api/agent/clients
POST   /api/agent/clients
GET    /api/agent/clients/[id]
PATCH  /api/agent/clients/[id]
DELETE /api/agent/clients/[id]

# Bookings
GET    /api/agent/bookings
POST   /api/agent/bookings
GET    /api/agent/bookings/[id]
PATCH  /api/agent/bookings/[id]/status

# Vouchers
GET    /api/agent/vouchers
POST   /api/agent/vouchers
PATCH  /api/agent/vouchers/[id]
DELETE /api/agent/vouchers/[id]
GET    /api/agent/vouchers/[code]/validate

# Commissions
GET    /api/agent/commissions
GET    /api/agent/commissions/summary
GET    /api/agent/commissions/[period]

# Payouts
GET    /api/agent/payouts
POST   /api/agent/payouts/request
GET    /api/agent/payouts/[id]

# Referrals
GET    /api/agent/referrals
GET    /api/agent/referrals/link
POST   /api/agent/referrals/track

# Analytics
GET    /api/agent/analytics/sales
GET    /api/agent/analytics/clients
GET    /api/agent/analytics/revenue
GET    /api/agent/analytics/commissions

# Reports
GET    /api/agent/reports/monthly
GET    /api/agent/reports/custom
```

### Database Tables
- `users` (role: 'agent')
- `partners` (type: 'agent')
- `agent_clients`
- `bookings` (created_by_agent)
- `vouchers`
- `agent_commissions`
- `commission_payouts`
- `agent_metrics`
- `referral_codes`

---

## 6Ô∏è‚É£ ADMIN (üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π. –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º.

### Permissions
```
READ:   All data
WRITE:  All entities
DELETE: All entities
UPDATE: All configurations
EXECUTE: System operations
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç—É—Ä–æ–≤
- ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏—è–º–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç–∞–º–∏
- ‚úÖ Email-—à–∞–±–ª–æ–Ω—ã
- ‚úÖ SMS-—à–∞–±–ª–æ–Ω—ã
- ‚úÖ Notification settings
- ‚úÖ System settings
- ‚úÖ Email templates
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –õ–æ–≥–∏ –∏ –∞—É–¥–∏—Ç
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ Backup & Recovery

### Related Entities
```
Admin ‚Üí All entities
Admin ‚Üí AdminLogs
Admin ‚Üí AdminAlerts
Admin ‚Üí AdminSettings
Admin ‚Üí EmailTemplates
Admin ‚Üí SystemConfigurations
```

### Dashboard
**URL:** `/hub/admin` –∏–ª–∏ `/dashboard/admin`

**–†–∞–∑–¥–µ–ª—ã:**
- Overview (–æ–±–∑–æ—Ä)
- Users Management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
- Content Moderation (–º–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
- Finance Management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏)
- Settings (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- Reports & Analytics (–æ—Ç—á–µ—Ç—ã)
- System (—Å–∏—Å—Ç–µ–º–∞)
- Security (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### API Endpoints
```
# Dashboard
GET    /api/admin/dashboard
GET    /api/admin/dashboard/summary

# Users Management
GET    /api/admin/users
POST   /api/admin/users
GET    /api/admin/users/[id]
PATCH  /api/admin/users/[id]
DELETE /api/admin/users/[id]
PATCH  /api/admin/users/[id]/role
PATCH  /api/admin/users/[id]/status
POST   /api/admin/users/[id]/suspend
POST   /api/admin/users/[id]/unsuspend

# Content Moderation - Tours
GET    /api/admin/content/tours
GET    /api/admin/content/tours/[id]
PATCH  /api/admin/content/tours/[id]
DELETE /api/admin/content/tours/[id]
POST   /api/admin/content/tours/[id]/approve
POST   /api/admin/content/tours/[id]/reject
POST   /api/admin/content/tours/[id]/flag

# Content Moderation - Reviews
GET    /api/admin/content/reviews
GET    /api/admin/content/reviews/[id]
POST   /api/admin/content/reviews/[id]/approve
POST   /api/admin/content/reviews/[id]/reject
DELETE /api/admin/content/reviews/[id]
POST   /api/admin/content/reviews/[id]/flag

# Content Moderation - Partners
GET    /api/admin/content/partners
GET    /api/admin/content/partners/[id]
POST   /api/admin/content/partners/[id]/verify
POST   /api/admin/content/partners/[id]/reject
PATCH  /api/admin/content/partners/[id]/status

# Finance Management
GET    /api/admin/finance/summary
GET    /api/admin/finance/transactions
GET    /api/admin/finance/payouts
GET    /api/admin/finance/revenue
GET    /api/admin/finance/commissions
POST   /api/admin/finance/payouts/[id]/process
POST   /api/admin/finance/payouts/[id]/reject

# Settings
GET    /api/admin/settings
PATCH  /api/admin/settings
GET    /api/admin/settings/email-templates
POST   /api/admin/settings/email-templates
PATCH  /api/admin/settings/email-templates/[id]
DELETE /api/admin/settings/email-templates/[id]
GET    /api/admin/settings/sms-templates
POST   /api/admin/settings/sms-templates
PATCH  /api/admin/settings/sms-templates/[id]
DELETE /api/admin/settings/sms-templates/[id]

# System Configuration
GET    /api/admin/system/config
PATCH  /api/admin/system/config
GET    /api/admin/system/status
POST   /api/admin/system/backup
GET    /api/admin/system/logs

# Analytics & Reports
GET    /api/admin/analytics/overview
GET    /api/admin/analytics/users
GET    /api/admin/analytics/bookings
GET    /api/admin/analytics/revenue
GET    /api/admin/analytics/tours
GET    /api/admin/analytics/exports

# Security & Audit
GET    /api/admin/security/logs
GET    /api/admin/security/alerts
GET    /api/admin/audit-logs
POST   /api/admin/security/ip-whitelist
POST   /api/admin/security/2fa-settings
```

### Database Tables
- `users` (role: 'admin')
- `admin_logs`
- `audit_logs`
- `admin_alerts`
- `admin_settings`
- `email_templates`
- `sms_templates`
- `system_configuration`
- `content_moderation_queue`
- `security_logs`

---

## 7Ô∏è‚É£ ADDITIONAL ROLES (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏)

### STAY PROVIDER (üè® –ü—Ä–æ–≤–∞–π–¥–µ—Ä —Ä–∞–∑–º–µ—â–µ–Ω–∏—è)
```
Dashboard: /hub/stay-provider
Manage:    Accommodations, Prices, Availability
Earnings:  Commission from bookings
```

### CAR RENTAL (üöô –ü—Ä–æ–∫–∞—Ç –∞–≤—Ç–æ)
```
Dashboard: /hub/cars
Manage:    Vehicle fleet, Rentals, Drivers
Earnings:  Revenue from rentals
```

### GEAR RENTAL (‚õ∫ –ü—Ä–æ–∫–∞—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è)
```
Dashboard: /hub/gear
Manage:    Equipment inventory, Rentals
Earnings:  Revenue from equipment rentals
```

### SOUVENIR SHOP (üéÅ –ú–∞–≥–∞–∑–∏–Ω —Å—É–≤–µ–Ω–∏—Ä–æ–≤)
```
Dashboard: /hub/souvenirs
Manage:    Product catalog, Orders, Inventory
Earnings:  Product sales commission
```

### SAFETY SERVICE (üõ°Ô∏è –°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
```
Dashboard: /hub/safety
Monitor:   Group safety, Emergency response
Report:    Incident reports, Risk assessment
```

### DRIVER (üë®‚Äçüöó –í–æ–¥–∏—Ç–µ–ª—å)
```
App:       Mobile driver app
Tasks:     Accept transfers, Navigate, Report issues
Earnings:  Trip-based commission
```

---

# üì¶ –°–£–©–ù–û–°–¢–ò (ENTITIES)

## –£–†–û–í–ï–ù–¨ 1: CORE ENTITIES

### 1. USER (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
```typescript
{
  id: UUID
  email: string (unique)
  phone: string
  firstName: string
  lastName: string
  dateOfBirth: Date
  gender: enum('male', 'female', 'other')
  role: enum (6+ —Ç–∏–ø–æ–≤)
  status: enum('active', 'inactive', 'suspended', 'banned')
  avatar: Asset
  nationality: string
  language: string
  currency: string
  timezone: string
  emailVerified: boolean
  phoneVerified: boolean
  twoFactorEnabled: boolean
  lastLogin: DateTime
  createdAt: DateTime
  updatedAt: DateTime
}

Relations:
  - Bookings (1:M)
  - Reviews (1:M)
  - Payments (1:M)
  - LoyaltyProfile (1:1)
  - EcoPoints (1:1)
  - Preferences (1:1)
  - Addresses (1:M)
  - PaymentMethods (1:M)
```

### 2. TOUR (–¢—É—Ä)
```typescript
{
  id: UUID
  title: string
  slug: string (unique)
  description: string
  shortDescription: string
  operatorId: UUID ‚Üí Partner/Operator
  category: string
  difficulty: enum('easy', 'medium', 'hard', 'extreme')
  duration: {
    days: number
    nights: number
    startTime: string
    endTime: string
  }
  season: enum('year-round', 'spring', 'summer', 'autumn', 'winter')
  pricing: {
    priceFrom: number
    priceTo: number
    currency: string
    childDiscount: number
    groupDiscount: number
  }
  capacity: {
    minParticipants: number
    maxParticipants: number
    currentlyBooked: number
  }
  location: {
    region: string
    startPoint: GeoPoint
    endPoint: GeoPoint
    coordinates: [longitude, latitude]
  }
  inclusions: {
    guides: boolean
    meals: string[]
    accommodation: boolean
    transport: boolean
    equipment: string[]
  }
  requirements: {
    physicalLevel: string
    skills: string[]
    equipment: string[]
    certifications: string[]
    weatherConditions: string[]
    ageRestrictions: {
      minAge: number
      maxAge: number
    }
  }
  safety: {
    safetyRating: number
    insuranceIncluded: boolean
    emergencyProtocol: string
    guidedGroupSize: number
  }
  media: {
    images: Asset[]
    videos: Asset[]
    thumbnail: Asset
  }
  rating: {
    averageRating: number
    reviewCount: number
    ratingBreakdown: {
      1: number
      2: number
      3: number
      4: number
      5: number
    }
  }
  status: enum('draft', 'active', 'inactive', 'cancelled')
  isVerified: boolean
  isPremium: boolean
  tags: string[]
  seoMeta: {
    title: string
    description: string
    keywords: string[]
  }
  createdAt: DateTime
  updatedAt: DateTime
  deletedAt: DateTime (soft delete)
}

Relations:
  - Operator (M:1) ‚Üí Partner
  - Bookings (1:M)
  - Reviews (1:M)
  - Schedules (1:M)
  - Guides (M:M)
  - Assets (M:M)
  - Inclusions (M:M)
```

### 3. BOOKING (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
```typescript
{
  id: UUID
  bookingNumber: string (unique, format: BK-YYYYMMDD-XXXXX)
  
  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  userId: UUID ‚Üí User (—Ç—É—Ä–∏—Å—Ç)
  operatorId: UUID ‚Üí Partner (—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä)
  agentId: UUID ‚Üí Partner (–∞–≥–µ–Ω—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å)
  
  // –¢—É—Ä
  tourId: UUID ‚Üí Tour
  scheduleId: UUID ‚Üí TourSchedule
  startDate: DateTime
  endDate: DateTime
  
  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  primaryParticipant: {
    firstName: string
    lastName: string
    email: string
    phone: string
    passport: string
  }
  additionalParticipants: [
    {
      firstName: string
      lastName: string
      age: number
      relationshipToMain: string
    }
  ]
  totalParticipants: number
  
  // –§–∏–Ω–∞–Ω—Å—ã
  pricing: {
    pricePerPerson: number
    subtotal: number
    discount: number (if voucher/promo)
    tax: number
    totalPrice: number
    currency: string
    paymentStatus: enum('pending', 'partial', 'paid', 'refunded')
    paidAmount: number
    remainingAmount: number
  }
  
  // –°—Ç–∞—Ç—É—Å—ã
  bookingStatus: enum(
    'pending',          // –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    'confirmed',        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
    'paid',             // –û–ø–ª–∞—á–µ–Ω–æ
    'in-progress',      // –ò–¥–µ—Ç –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
    'completed',        // –ó–∞–≤–µ—Ä—à–µ–Ω–æ
    'cancelled',        // –û—Ç–º–µ–Ω–µ–Ω–æ
    'no-show'           // –ù–µ –ø—Ä–∏—à–µ–ª
  )
  
  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
  specialRequests: string
  dietaryRestrictions: string[]
  mobileNumber: string
  emergencyContact: {
    name: string
    phone: string
    relation: string
  }
  
  // –î–æ–∫—É–º–µ–Ω—Ç—ã
  documents: {
    passport: Asset
    visa: Asset
    insurance: Asset
  }
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  confirmedAt: DateTime
  paidAt: DateTime
  completedAt: DateTime
  cancelledAt: DateTime
  cancellationReason: string
  
  // –ö–æ–Ω—Ç—Ä–æ–ª—å
  lastModifiedBy: UUID
  lastModifiedAt: DateTime
}

Relations:
  - User (M:1)
  - Tour (M:1)
  - TourSchedule (M:1)
  - Operator (M:1)
  - Agent (M:0-1)
  - Payment (1:1)
  - Review (0:1)
  - Invoice (1:1)
  - Voucher (0:1)
```

### 4. REVIEW (–û—Ç–∑—ã–≤)
```typescript
{
  id: UUID
  
  // –ê–≤—Ç–æ—Ä –∏ –æ–±—ä–µ–∫—Ç
  userId: UUID ‚Üí User
  tourId: UUID ‚Üí Tour
  bookingId: UUID ‚Üí Booking (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏)
  
  // –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
  title: string
  content: string
  rating: number (1-5)
  
  // –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
  detailedRating: {
    guideQuality: number
    safetyLevel: number
    organizationQuality: number
    valueForMoney: number
    scenery: number
    experience: number
  }
  
  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
  wouldRecommend: boolean
  visitDate: Date
  isVerified: boolean (verified if booking completed)
  withPhotos: boolean
  
  // –ú–æ–¥–µ—Ä–∞—Ü–∏—è
  status: enum('pending', 'approved', 'rejected', 'flagged')
  isHelpful: number (votes)
  isFlagged: boolean
  flagReason: string
  flaggedAt: DateTime
  
  // –†–µ–∞–∫—Ü–∏–∏
  likes: number
  dislikes: number
  
  // –°–∏—Å—Ç–µ–º–Ω—ã–µ
  createdAt: DateTime
  updatedAt: DateTime
  publishedAt: DateTime
}

Relations:
  - User (M:1)
  - Tour (M:1)
  - Booking (M:0-1)
```

---

## –£–†–û–í–ï–ù–¨ 2: TRANSACTION ENTITIES

### 5. PAYMENT (–ü–ª–∞—Ç–µ–∂)
```typescript
{
  id: UUID
  paymentId: string (unique, –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º)
  
  // –°–≤—è–∑–∏
  bookingId: UUID ‚Üí Booking (–æ–±—ã—á–Ω–æ)
  userId: UUID ‚Üí User
  operatorId: UUID ‚Üí Partner
  
  // –°—É–º–º–∞
  amount: number
  currency: string
  
  // –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
  paymentMethod: enum(
    'credit_card',
    'debit_card',
    'bank_transfer',
    'yandex_kassa',
    'sberbank',
    'paypal',
    'cryptocurrency',
    'voucher',
    'loyalty_points'
  )
  
  // –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞
  paymentGateway: string (Stripe, CloudPayments, etc)
  transactionId: string
  
  // –°—Ç–∞—Ç—É—Å
  status: enum(
    'pending',
    'processing',
    'completed',
    'failed',
    'refunded',
    'cancelled'
  )
  
  // –†–µ—Ñ—É–Ω–¥
  refundStatus: enum('none', 'partial', 'full')
  refundAmount: number
  refundReason: string
  
  // –†–µ–∫–≤–∏–∑–∏—Ç—ã
  cardLast4: string (masked)
  cardBrand: string
  bankName: string
  accountNumber: string (masked)
  
  // –°—Ä–æ–∫–∏
  createdAt: DateTime
  completedAt: DateTime
  refundedAt: DateTime
}

Relations:
  - Booking (M:1)
  - User (M:1)
  - Operator (M:1)
  - Invoice (1:1)
```

### 6. INVOICE (–°—á–µ—Ç)
```typescript
{
  id: UUID
  invoiceNumber: string (unique, format: INV-YYYYMMDD-XXXXX)
  
  // –°–≤—è–∑–∏
  bookingId: UUID ‚Üí Booking
  paymentId: UUID ‚Üí Payment
  
  // –î–∞–Ω–Ω—ã–µ
  issueDate: Date
  dueDate: Date
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥–∞–≤—Ü–µ
  seller: {
    name: string
    taxId: string
    address: string
    email: string
    phone: string
  }
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ
  buyer: {
    name: string
    email: string
    address: string
    phone: string
  }
  
  // –ü–æ–∑–∏—Ü–∏–∏
  items: [
    {
      description: string
      quantity: number
      unitPrice: number
      total: number
    }
  ]
  
  // –ò—Ç–æ–≥–æ
  subtotal: number
  tax: number
  discount: number
  total: number
  
  // –°—Ç–∞—Ç—É—Å
  status: enum('draft', 'sent', 'viewed', 'paid', 'overdue', 'cancelled')
  
  // –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
  paymentTerms: string
  bankDetails: object
  
  // –°–∏—Å—Ç–µ–º–∞
  createdAt: DateTime
  sentAt: DateTime
  paidAt: DateTime
}

Relations:
  - Booking (M:1)
  - Payment (M:1)
```

---

## –£–†–û–í–ï–ù–¨ 3: SERVICE ENTITIES

### 7. CAR RENTAL (–ê—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è)
```typescript
{
  id: UUID
  rentalNumber: string (unique)
  
  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  customerId: UUID ‚Üí User
  carId: UUID ‚Üí Car
  operatorId: UUID ‚Üí Partner (car rental operator)
  
  // –î–∞—Ç—ã
  pickupDate: Date
  returnDate: Date
  pickupTime: Time
  returnTime: Time
  daysCount: number
  
  // –õ–æ–∫–∞—Ü–∏–∏
  pickupLocation: string
  returnLocation: string
  
  // –í–æ–¥–∏—Ç–µ–ª—å
  primaryDriver: {
    firstName: string
    lastName: string
    licenseNumber: string
    licenseExpiry: Date
    age: number
  }
  additionalDrivers: [
    {
      firstName: string
      lastName: string
      licenseNumber: string
    }
  ]
  
  // –§–∏–Ω–∞–Ω—Å—ã
  pricing: {
    dailyRate: number
    daysCount: number
    basePrice: number
    insurance: {
      type: enum('basic', 'premium', 'none')
      cost: number
    }
    additionalServices: [
      {
        name: string
        cost: number
      }
    ]
    deposit: number
    discount: number
    totalPrice: number
    currency: string
  }
  
  // –°—Ç–∞—Ç—É—Å
  status: enum(
    'pending',
    'confirmed',
    'active',
    'completed',
    'cancelled'
  )
  
  // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
  specialRequests: string
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  confirmedAt: DateTime
  startedAt: DateTime
  completedAt: DateTime
}

Relations:
  - User (M:1)
  - Car (M:1)
  - CarRentalOperator (M:1)
  - Payment (1:1)
  - Insurance (0:1)
```

### 8. GEAR RENTAL (–ê—Ä–µ–Ω–¥–∞ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è)
```typescript
{
  id: UUID
  rentalNumber: string (unique)
  
  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  customerId: UUID ‚Üí User
  bookingId: UUID ‚Üí Booking (optional, tour-related)
  
  // –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
  items: [
    {
      gearId: UUID ‚Üí GearEquipment
      name: string
      category: string
      quantity: number
      pricePerUnit: number
      totalPrice: number
    }
  ]
  
  // –î–∞—Ç—ã
  startDate: Date
  endDate: Date
  totalDays: number
  
  // –°—Ç–∞—Ç—É—Å
  status: enum('pending', 'confirmed', 'active', 'completed', 'cancelled')
  
  // –§–∏–Ω–∞–Ω—Å—ã
  pricing: {
    subtotal: number
    deposit: number
    discount: number
    totalPrice: number
    currency: string
  }
  
  // –î–æ—Å—Ç–∞–≤–∫–∞
  deliveryMethod: enum('self-pickup', 'delivery', 'return-at-location')
  
  // –£—Å–ª–æ–≤–∏—è
  depositRequired: boolean
  depositAmount: number
  damageWaiver: boolean
  
  // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
  specialRequests: string
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  confirmedAt: DateTime
  pickedUpAt: DateTime
  returnedAt: DateTime
}

Relations:
  - User (M:1)
  - GearEquipment (M:M)
  - Booking (M:0-1)
  - Payment (1:1)
```

### 9. TRANSFER BOOKING (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞)
```typescript
{
  id: UUID
  transferNumber: string (unique)
  
  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  passengerId: UUID ‚Üí User
  driverId: UUID ‚Üí Driver (assigned later)
  vehicleId: UUID ‚Üí Vehicle (assigned later)
  transferOperatorId: UUID ‚Üí Partner
  
  // –ú–∞—Ä—à—Ä—É—Ç
  pickupLocation: GeoPoint
  dropoffLocation: GeoPoint
  pickupTime: DateTime
  estimatedArrivalTime: DateTime
  
  // –ü–∞—Å—Å–∞–∂–∏—Ä—ã
  primaryPassenger: {
    firstName: string
    lastName: string
    phone: string
    email: string
  }
  additionalPassengers: number
  specialRequests: string
  
  // –¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
  vehicleType: enum('car', 'minivan', 'bus', 'helicopter', 'boat')
  
  // –°—Ç–∞—Ç—É—Å
  status: enum(
    'pending',
    'confirmed',
    'assigned',
    'driver-accepted',
    'en-route',
    'arrived',
    'completed',
    'cancelled'
  )
  
  // –§–∏–Ω–∞–Ω—Å—ã
  pricing: {
    basePrice: number
    distancePrice: number
    surgePrice: number (if applicable)
    discount: number
    totalPrice: number
    currency: string
    paymentStatus: enum('pending', 'paid', 'refunded')
  }
  
  // GPS
  gpsEnabled: boolean
  currentLocation: GeoPoint (for active transfers)
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  confirmedAt: DateTime
  completedAt: DateTime
}

Relations:
  - User (M:1)
  - Driver (M:0-1)
  - Vehicle (M:0-1)
  - TransferRoute (M:1)
  - Payment (1:1)
```

---

## –£–†–û–í–ï–ù–¨ 4: PARTNER & BUSINESS ENTITIES

### 10. PARTNER (–ü–∞—Ä—Ç–Ω–µ—Ä)
```typescript
{
  id: UUID
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  name: string (company name)
  type: enum(
    'operator',      // –¢—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä
    'guide',         // –ì–∏–¥
    'transfer',      // –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ–ø–µ—Ä–∞—Ç–æ—Ä
    'stay',          // –†–∞–∑–º–µ—â–µ–Ω–∏–µ
    'car-rental',    // –ü—Ä–æ–∫–∞—Ç –∞–≤—Ç–æ
    'gear-rental',   // –ü—Ä–æ–∫–∞—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è
    'souvenir',      // –°—É–≤–µ–Ω–∏—Ä—ã
    'restaurant',    // –†–µ—Å—Ç–æ—Ä–∞–Ω
    'agent'          // –ê–≥–µ–Ω—Ç/–†–µ—Å–µ–ª–ª–µ—Ä
  )
  
  // –ö–æ–Ω—Ç–∞–∫—Ç—ã
  email: string (unique)
  phone: string
  website: string
  socialMedia: {
    facebook: string
    instagram: string
    vk: string
  }
  
  // –ê–¥—Ä–µ—Å
  address: {
    street: string
    city: string
    region: string
    postalCode: string
    country: string
  }
  coordinates: GeoPoint
  
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  registrationNumber: string (company registration)
  taxId: string (–ò–ù–ù)
  bankAccount: string
  legalForm: string (–û–û–û, –ò–ü, –ê–û, –∏ —Ç.–¥.)
  
  // –ü—Ä–æ—Ñ–∏–ª—å
  description: string (bio/about)
  logo: Asset
  coverImage: Asset
  media: Asset[]
  
  // –†–µ–π—Ç–∏–Ω–≥
  rating: {
    averageRating: number
    reviewCount: number
    totalEarnings: number
  }
  
  // –°—Ç–∞—Ç—É—Å
  status: enum('pending', 'active', 'inactive', 'banned')
  isVerified: boolean
  verificationDate: DateTime
  verificationDocument: Asset
  
  // –ö–æ–º–∏—Å—Å–∏—è
  commissionRate: number (percentage)
  payoutMethod: enum('bank_transfer', 'wallet', 'cryptocurrency')
  
  // –°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  supportEmail: string
  supportPhone: string
  supportHours: string
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  autoApproveBookings: boolean
  requirePaymentUpfront: boolean
  cancellationPolicy: string
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  updatedAt: DateTime
  lastActiveAt: DateTime
}

Relations:
  - User (1:1 –∏–ª–∏ M:1 –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤)
  - Tours (1:M, –µ—Å–ª–∏ operator)
  - Vehicles (1:M, –µ—Å–ª–∏ transfer)
  - GearEquipment (1:M, –µ—Å–ª–∏ gear rental)
  - Bookings (1:M)
  - Assets (M:M)
  - Reviews (1:M)
  - Commissions (1:M)
  - Payouts (1:M)
```

### 11. VOUCHER (–í–∞—É—á–µ—Ä/–ö—É–ø–æ–Ω)
```typescript
{
  id: UUID
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  code: string (unique, format: KAMHUB2025XXX)
  title: string
  description: string
  
  // –°–∫–∏–¥–∫–∞
  discountType: enum('fixed', 'percentage')
  discountValue: number
  maxDiscount: number (for percentage)
  minBookingAmount: number
  
  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
  applicableTo: enum(
    'all',
    'tours',
    'transfers',
    'gear-rental',
    'car-rental',
    'specific-tour'
  )
  specificPartner: UUID (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É –ø–∞—Ä—Ç–Ω–µ—Ä—É)
  specificTour: UUID (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Ç—É—Ä—É)
  
  // –õ–∏–º–∏—Ç—ã
  usageLimit: number (total times)
  perUserLimit: number
  usageCount: number
  
  // –î–∞—Ç—ã –¥–µ–π—Å—Ç–≤–∏—è
  validFrom: DateTime
  validUntil: DateTime
  
  // –°—Ç–∞—Ç—É—Å
  status: enum('active', 'inactive', 'expired')
  isAutoApplied: boolean
  
  // –°–æ–∑–¥–∞—Ç–µ–ª—å
  createdBy: UUID (admin or partner)
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  updatedAt: DateTime
}

Relations:
  - Bookings (M:M)
  - Users (M:M through usage history)
```

### 12. LOYALTY PROFILE (–ü—Ä–æ—Ñ–∏–ª—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
```typescript
{
  id: UUID
  userId: UUID ‚Üí User (unique)
  
  // –ë–∞–ª–ª—ã
  totalPoints: number
  availablePoints: number
  spentPoints: number
  
  // –£—Ä–æ–≤–µ–Ω—å
  currentLevel: enum(
    'bronze',       // 0 points
    'silver',       // 1000 points
    'gold',         // 5000 points
    'platinum',     // 10000 points
    'diamond'       // 25000+ points
  )
  
  levelProgress: {
    currentLevelPoints: number
    nextLevelPoints: number
    progressPercentage: number
  }
  
  // –ë–µ–Ω–µ—Ñ–∏—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  benefits: {
    discountPercent: number
    priorityBooking: boolean
    personalManager: boolean
    exclusiveTours: boolean
    freeUpgrades: number
    anniversaryBonus: number
  }
  
  // –ò—Å—Ç–æ—Ä–∏—è
  pointsHistory: [
    {
      date: DateTime
      action: string
      points: number
      relatedBooking: UUID
    }
  ]
  
  // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
  referralCode: string (unique)
  referredUsers: number
  referralBonus: number
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  totalSpent: number
  totalBookings: number
  memberSince: DateTime
  lastActivityDate: DateTime
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  emailNotifications: boolean
  includePartnerOffers: boolean
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  updatedAt: DateTime
}

Relations:
  - User (1:1)
  - PointsTransactions (1:M)
```

---

## –£–†–û–í–ï–ù–¨ 5: OPERATIONAL ENTITIES

### 13. ECO POINTS (–≠–∫–æ-–±–∞–ª–ª—ã)
```typescript
{
  id: UUID
  userId: UUID ‚Üí User (unique)
  
  // –ë–∞–ª–ª—ã
  totalEcoPoints: number
  
  // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  activities: [
    {
      type: enum(
        'public_transport',    // –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        'carbon_offset',       // –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —É–≥–ª–µ—Ä–æ–¥–∞
        'waste_reduction',     // –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Ç—Ö–æ–¥–æ–≤
        'eco_tour',            // –≠–∫–æ–ª–æ–≥–∏—á–Ω—ã–π —Ç—É—Ä
        'group_booking'        // –ì—Ä—É–ø–ø–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      )
      points: number
      date: DateTime
      description: string
      relatedBooking: UUID
    }
  ]
  
  // –£—Ä–æ–≤–µ–Ω—å —ç–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  ecoLevel: enum(
    'beginner',
    'enthusiast',
    'activist',
    'champion'
  )
  
  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  achievements: [
    {
      id: string
      name: string
      unlockedAt: DateTime
    }
  ]
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  updatedAt: DateTime
}

Relations:
  - User (1:1)
```

### 14. GUIDE SCHEDULE (–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≥–∏–¥–∞)
```typescript
{
  id: UUID
  guideId: UUID ‚Üí User
  tourId: UUID ‚Üí Tour
  
  // –î–∞—Ç—ã –∏ –≤—Ä–µ–º—è
  startDate: Date
  endDate: Date
  startTime: Time
  endTime: Time
  groupSize: number
  
  // –°—Ç–∞—Ç—É—Å
  status: enum('available', 'booked', 'completed', 'cancelled')
  
  // –°–≤—è–∑—å —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
  bookings: UUID[] (Booking IDs)
  
  // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
  notes: string
  specialRequirements: string
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  createdAt: DateTime
  updatedAt: DateTime
}

Relations:
  - Guide (M:1)
  - Tour (M:1)
  - Bookings (1:M)
```

### 15. SAFETY REPORT (–û—Ç—á–µ—Ç –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
```typescript
{
  id: UUID
  guideId: UUID ‚Üí Guide
  groupId: UUID ‚Üí GuideGroup
  tourId: UUID ‚Üí Tour
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  reportDate: DateTime
  groupSize: number
  weatherConditions: string
  
  // –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã
  incidents: [
    {
      type: string
      severity: enum('low', 'medium', 'high', 'critical')
      description: string
      timestamp: DateTime
      resolved: boolean
      resolution: string
    }
  ]
  
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–ø–ø—ã
  groupMorale: enum('good', 'neutral', 'poor')
  physicalCondition: enum('good', 'fair', 'poor')
  anyMedicalIssues: boolean
  medicalDetails: string
  
  // –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
  equipmentStatus: enum('good', 'fair', 'needs_replacement')
  equipmentIssues: string[]
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  photosCount: number
  videosCount: number
  
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  submittedAt: DateTime
  reviewedAt: DateTime
  reviewedBy: UUID (admin or supervisor)
}

Relations:
  - Guide (M:1)
  - Group (M:1)
  - Tour (M:1)
```

---

# üîó –°–í–Ø–ó–ò –ú–ï–ñ–î–£ –°–£–©–ù–û–°–¢–Ø–ú–ò

## –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π (ER Diagram –ö–æ–Ω—Ü–µ–ø—Ü–∏—è)

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  USER    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    /    |    \
                   /     |     \
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      |      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì                 ‚Üì                 ‚Üì
    BOOKING         LOYALTYPROFILE     ECOPOINTS
        |                                    
        ‚Üì                                    
    PAYMENT ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         
        |                        |         
        ‚îú‚îÄ TOUR ‚îÄ‚îÄ‚Üí OPERATOR    ‚îÇ         
        ‚îÇ           (PARTNER)    ‚îÇ         
        ‚îú‚îÄ REVIEW               ‚îÇ         
        ‚îî‚îÄ INVOICE              ‚îÇ         
                                 ‚îÇ         
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
    COMMISSION
        ‚îÇ
        ‚îú‚îÄ PAYOUT
        ‚îî‚îÄ AGENT (PARTNER)
        
    TRANSFER:
        USER ‚îÄ‚îÄ‚Üí TRANSFERBOOKING ‚Üê‚îÄ DRIVER, VEHICLE, TRANSFERROUTE
        
    RENTAL:
        USER ‚îÄ‚îÄ‚Üí CARRENATAL ‚îÄ‚îÄ‚Üí CAR, INSURANCE
        USER ‚îÄ‚îÄ‚Üí GEARRENTAL ‚îÄ‚îÄ‚Üí GEAREQUIPMENT (M:M)
        
    GUIDE SYSTEM:
        GUIDE ‚îÄ‚îÄ‚Üí GUIDESCHEDULE ‚îÄ‚îÄ‚Üí TOUR
        GUIDE ‚îÄ‚îÄ‚Üí GUIDEGROUP ‚îÄ‚îÄ‚Üí BOOKING (M:M)
        GUIDE ‚îÄ‚îÄ‚Üí SAFETYREPORT ‚îÄ‚îÄ‚Üí GUIDEGROUP, TOUR
```

---

# üìä –î–ò–ê–ì–†–ê–ú–ú–´ –ü–û–¢–û–ö–û–í –î–ê–ù–ù–´–•

## PROCESS 1: Tourist Booking Flow

```
TOURIST (User)
    ‚Üì
[SEARCH TOURS]
    ‚Üì
Browse Tours, Read Reviews, Check Ratings
    ‚Üì
[SELECT TOUR]
    ‚Üì
Select Schedule, Participants, Special Requests
    ‚Üì
[CREATE BOOKING] ‚Üí BOOKING (status: pending)
    ‚Üì
[PAYMENT] ‚Üí PAYMENT (status: processing)
    ‚Üì
[PAYMENT SUCCESS] 
    ‚îú‚îÄ BOOKING.status = confirmed
    ‚îú‚îÄ PAYMENT.status = completed
    ‚îú‚îÄ Award LOYALTY POINTS
    ‚îî‚îÄ Send CONFIRMATION EMAIL
    ‚Üì
[ON TOUR DATE]
    ‚îú‚îÄ BOOKING.status = in-progress
    ‚îî‚îÄ GUIDE starts SAFETY REPORT
    ‚Üì
[TOUR COMPLETED]
    ‚îú‚îÄ BOOKING.status = completed
    ‚îú‚îÄ Award LOYALTY POINTS
    ‚îú‚îÄ Enable REVIEW posting
    ‚îî‚îÄ Send FEEDBACK EMAIL
    ‚Üì
[REVIEW SUBMISSION]
    ‚îú‚îÄ REVIEW.status = pending (moderation)
    ‚îî‚îÄ Send to ADMIN for approval
```

## PROCESS 2: Operator Commission Flow

```
OPERATOR (Partner)
    ‚Üì
[CREATE TOUR] ‚Üí TOUR (status: active)
    ‚Üì
[TOURIST BOOKS] ‚Üí BOOKING created
    ‚Üì
[PAYMENT RECEIVED] ‚Üí PAYMENT.status = completed
    ‚Üì
[OPERATOR COMMISSION CALCULATED]
    commission = booking_amount √ó commission_rate
    ‚Üì
[AGENTCOMMISSION RECORD CREATED]
    status: pending
    ‚Üì
[MONTHLY PROCESSING]
    ‚îú‚îÄ Sum all commissions for period
    ‚îú‚îÄ Deduct platform fees
    ‚îú‚îÄ Calculate taxes
    ‚îî‚îÄ Create PAYOUT RECORD (status: pending)
    ‚Üì
[OPERATOR REQUESTS PAYOUT]
    ‚îî‚îÄ PAYOUT.status = requested
    ‚Üì
[ADMIN VERIFIES & APPROVES]
    ‚îî‚îÄ PAYOUT.status = approved
    ‚Üì
[PROCESS TRANSFER]
    ‚îú‚îÄ Bank Transfer Initiated
    ‚îî‚îÄ PAYOUT.status = completed, processedAt = DateTime
    ‚Üì
[NOTIFY OPERATOR]
    ‚îî‚îÄ Send PAYOUT CONFIRMATION
```

## PROCESS 3: Multi-Service Booking

```
TOURIST (User)
    ‚îú‚îÄ [BOOK TOUR] ‚Üí BOOKING, PAYMENT
    ‚îú‚îÄ [RENT CAR] ‚Üí CARRENATAL, PAYMENT
    ‚îú‚îÄ [RENT GEAR] ‚Üí GEARRENTAL, PAYMENT
    ‚îî‚îÄ [BUY SOUVENIRS] ‚Üí SOUVENIRORDER, PAYMENT
    ‚Üì
[CONSOLIDATED INVOICE] ‚Üí Single INVOICE with all items
    ‚Üì
[SINGLE PAYMENT] ‚Üí One PAYMENT for total
    ‚Üì
[SUCCESS]
    ‚îú‚îÄ All bookings confirmed
    ‚îú‚îÄ LOYALTY POINTS = sum of all
    ‚îî‚îÄ Confirmation email with all bookings
```

---

# üîê PERMISSIONS & ACCESS CONTROL

## Role-Based Access Control (RBAC)

### TOURIST Permissions
```
‚úì READ:   Own profile, all active tours, reviews, booking history
‚úó CREATE: Bookings, reviews, support tickets
‚úó UPDATE: Own profile, own bookings (before payment)
‚úó DELETE: Own reviews (after review period)
```

### OPERATOR Permissions
```
‚úì READ:   Own tours, own bookings, financial data
‚úì CREATE: Tours, tour schedules
‚úì UPDATE: Own tours, availability, pricing
‚úó DELETE: Tours (soft delete only)
‚úó READ:  Other operators' data
```

### ADMIN Permissions
```
‚úì READ:   All data
‚úì CREATE: Users, system configurations
‚úì UPDATE: Any entity
‚úì DELETE: Any entity (with logging)
‚úì EXECUTE: System operations, backups
```

## Row-Level Security (RLS)

```sql
-- Tourists see only their data
SELECT * FROM bookings WHERE user_id = auth.uid()

-- Operators see only their tours and related bookings
SELECT * FROM bookings WHERE tour_id IN (
  SELECT id FROM tours WHERE operator_id = auth.user_id()
)

-- Guides see only their assigned tours and groups
SELECT * FROM guide_schedules WHERE guide_id = auth.uid()
```

---

# üíæ DATABASE SCHEMA

## Key Tables Summary

| Table | Rows Est. | Size | Purpose |
|-------|-----------|------|---------|
| users | 50,000+ | ~25MB | User data |
| tours | 5,000+ | ~50MB | Tour listings |
| bookings | 100,000+ | ~80MB | Booking records |
| reviews | 50,000+ | ~40MB | Review/ratings |
| payments | 100,000+ | ~60MB | Payment records |
| partners | 1,000+ | ~10MB | Partner info |
| commissions | 50,000+ | ~30MB | Commission tracking |
| transfers | 30,000+ | ~25MB | Transfer bookings |

---

## –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ

```sql
-- Users
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);

-- Bookings (most critical)
CREATE INDEX idx_bookings_user_id ON bookings(user_id);
CREATE INDEX idx_bookings_tour_id ON bookings(tour_id);
CREATE INDEX idx_bookings_status ON bookings(status);
CREATE INDEX idx_bookings_created_at ON bookings(created_at DESC);

-- Tours
CREATE INDEX idx_tours_operator_id ON tours(operator_id);
CREATE INDEX idx_tours_status ON tours(status);
CREATE INDEX idx_tours_rating ON tours(rating DESC);

-- Payments
CREATE INDEX idx_payments_booking_id ON payments(booking_id);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_created_at ON payments(created_at DESC);

-- Reviews
CREATE INDEX idx_reviews_tour_id ON reviews(tour_id);
CREATE INDEX idx_reviews_user_id ON reviews(user_id);
CREATE INDEX idx_reviews_rating ON reviews(rating);
CREATE INDEX idx_reviews_status ON reviews(status);
```

---

## –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ —Ä–æ–ª–µ–π | 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö + 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö |
| –û—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π | 15+ core entities |
| –í—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –ë–î | 50+ tables |
| API endpoints | 150+ endpoints |
| –°–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ | 100+ relations |
| Workflow –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ | 20+ major flows |
| Permission –ø—Ä–∞–≤–∏–ª | 100+ RLS rules |

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ‚úÖ –ü–æ–ª–Ω—ã–π –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 28 —è–Ω–≤–∞—Ä—è 2026
**–í–µ—Ä—Å–∏—è:** 2.0
