# üî• –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –ò–• –†–ï–®–ï–ù–ò–Ø

**–î–∞—Ç–∞:** 7 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

---

## üéØ –ß–¢–û –¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò (–∏–∑ –æ—Ç—á—ë—Ç–∞)

–ò–∑ —Ñ–∞–π–ª–∞ `–ò–¢–û–ì–û–í–´–ô_–û–¢–ß–Å–¢_–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï_–ü–†–û–í–ï–†–ö–ê_–ò_–§–ò–ù–ê–ù–°–û–í–´–ô_–ê–ù–ê–õ–ò–ó.md` –≤—ã–¥–µ–ª–µ–Ω—ã:

### 1. **190+ –ø—É—Å—Ç—ã—Ö unit —Ç–µ—Å—Ç–æ–≤** 
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Ç–µ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ `expect(true).toBe(true)`
- **–§–∞–π–ª—ã:** 7 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 12-16 —á–∞—Å–æ–≤

### 2. **E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **–†–µ—à–µ–Ω–∏–µ:** Playwright
- **–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 4 —á–∞—Å–∞

### 3. **Sentry –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫ –≤ production
- **–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `@sentry/nextjs`
- **–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 2 —á–∞—Å–∞

### 4. **CDN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel CDN –∏–ª–∏ Cloudflare
- **–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 2 —á–∞—Å–∞

---

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 5. **Mock-operator-id –≤ tours/page.tsx**
```typescript
// –ö–†–ò–¢–ò–ß–ù–û!
const operatorId = 'mock-operator-id'; // ‚ùå
```

### 6. **Mock –¥–∞–Ω–Ω—ã–µ –≤ admin stats API**
```typescript
// app/api/admin/stats/route.ts
// TODO: –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
const stats = {
  totalUsers: 1547, // ‚ùå —Ö–∞—Ä–¥–∫–æ–¥
  ...
}
```

### 7. **15 TODO –≤ transfer-operator dashboard**
```typescript
email: '', // TODO: –∏–∑ –±–∞–∑—ã
licenseNumber: '', // TODO: –∏–∑ –±–∞–∑—ã
// –∏ –µ—â—ë 13 –ø–æ–ª–µ–π!
```

### 8. **258 console.log –≤ 123 —Ñ–∞–π–ª–∞—Ö**
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 9. **76 TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ 27 —Ñ–∞–π–ª–∞—Ö**

---

## ‚úÖ –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–ê–ì 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ (30 –º–∏–Ω—É—Ç)

#### 1.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å mock-operator-id
```typescript
// app/hub/operator/tours/page.tsx
// –ë–´–õ–û:
const operatorId = 'mock-operator-id';

// –°–¢–ê–õ–û:
import { useAuth } from '@/contexts/AuthContext';
const { user } = useAuth();
const operatorId = user?.id;
```

#### 1.2 –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
```typescript
// lib/auth/check-admin.ts
export async function requireAdmin(request: NextRequest) {
  const userId = request.headers.get('x-user-id');
  const userRole = request.headers.get('x-user-role');
  
  if (userRole !== 'admin') {
    return NextResponse.json(
      { success: false, error: 'Access denied' },
      { status: 403 }
    );
  }
  
  return null;
}
```

#### 1.3 –ó–∞–º–µ–Ω–∏—Ç—å –º–æ–∫–∏ –≤ admin stats –Ω–∞ –ë–î
```typescript
// app/api/admin/stats/route.ts
const totalUsersResult = await query('SELECT COUNT(*) as count FROM users');
const totalToursResult = await query('SELECT COUNT(*) as count FROM tours');
// –∏ —Ç.–¥.
```

---

### –®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É (1 —á–∞—Å)

#### 2.1 –û–±–Ω–æ–≤–∏—Ç—å tests/setup.ts
```typescript
import { vi, afterEach, beforeAll } from 'vitest';
import { cleanup } from '@testing-library/react';
import '@testing-library/jest-dom';

// Mock –ë–î
vi.mock('@/lib/database', () => ({
  query: vi.fn(),
  transaction: vi.fn(),
}));

// Mock Next.js
vi.mock('next/headers', () => ({
  headers: () => ({ get: vi.fn() }),
  cookies: () => ({ get: vi.fn() }),
}));

// Mock fetch
global.fetch = vi.fn();

afterEach(() => {
  cleanup();
  vi.clearAllMocks();
});
```

#### 2.2 –°–æ–∑–¥–∞—Ç—å helpers –¥–ª—è —Ç–µ—Å—Ç–æ–≤
```typescript
// tests/helpers/mock-data.ts
export const mockUser = {
  id: 'test-user-id',
  email: 'test@example.com',
  name: 'Test User',
  role: 'tourist',
};

export const mockTour = {
  id: 'test-tour-id',
  name: 'Test Tour',
  price: 5000,
  ...
};
```

---

### –®–ê–ì 3: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Unit —Ç–µ—Å—Ç—ã (12 —á–∞—Å–æ–≤)

#### 3.1 Auth API —Ç–µ—Å—Ç—ã (2 —á–∞—Å–∞)
```typescript
// tests/api/auth.test.ts
describe('POST /api/auth/signup', () => {
  it('should register new user', async () => {
    const mockQuery = vi.mocked(query);
    mockQuery.mockResolvedValueOnce({ rows: [], rowCount: 0 }); // –ø—Ä–æ–≤–µ—Ä–∫–∞ email
    mockQuery.mockResolvedValueOnce({ rows: [{ id: '123' }] }); // insert
    
    const response = await POST(createMockRequest({
      email: 'new@test.com',
      password: 'password123',
    }));
    
    expect(response.status).toBe(200);
    expect(mockQuery).toHaveBeenCalledTimes(2);
  });
});
```

#### 3.2 Bookings API —Ç–µ—Å—Ç—ã (3 —á–∞—Å–∞)
```typescript
// tests/api/bookings.test.ts
describe('GET /api/bookings', () => {
  it('should return user bookings', async () => {
    const mockQuery = vi.mocked(query);
    mockQuery.mockResolvedValueOnce({
      rows: [mockBooking1, mockBooking2],
    });
    
    const request = createMockRequest({
      headers: { 'x-user-id': 'user-123' },
    });
    
    const response = await GET(request);
    const data = await response.json();
    
    expect(data.success).toBe(true);
    expect(data.data).toHaveLength(2);
  });
});
```

#### 3.3 Payments API —Ç–µ—Å—Ç—ã (3 —á–∞—Å–∞)
#### 3.4 Reviews API —Ç–µ—Å—Ç—ã (2 —á–∞—Å–∞)
#### 3.5 Admin API —Ç–µ—Å—Ç—ã (2 —á–∞—Å–∞)

---

### –®–ê–ì 4: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Sentry (2 —á–∞—Å–∞)

#### 4.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç
```bash
npm install @sentry/nextjs
```

#### 4.2 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å sentry.client.config.ts
```typescript
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0,
  environment: process.env.NODE_ENV,
});
```

#### 4.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å sentry.server.config.ts
```typescript
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0,
});
```

#### 4.4 –ó–∞–º–µ–Ω–∏—Ç—å console.error –Ω–∞ Sentry
```typescript
// –ë–´–õ–û:
console.error('Error:', error);

// –°–¢–ê–õ–û:
Sentry.captureException(error, {
  tags: { module: 'bookings' },
  extra: { userId, bookingId },
});
```

---

### –®–ê–ì 5: –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã (4 —á–∞—Å–∞)

#### 5.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright
```bash
npm install -D @playwright/test
npx playwright install
```

#### 5.2 –°–æ–∑–¥–∞—Ç—å playwright.config.ts
```typescript
import { defineConfig } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  use: {
    baseURL: 'http://localhost:3000',
    screenshot: 'only-on-failure',
  },
});
```

#### 5.3 –ù–∞–ø–∏—Å–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
```typescript
// e2e/booking-flow.spec.ts
test('user can book a tour', async ({ page }) => {
  await page.goto('/tours');
  await page.click('text=–î–æ–ª–∏–Ω–∞ –≥–µ–π–∑–µ—Ä–æ–≤');
  await page.click('button:has-text("–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å")');
  
  await page.fill('[name="participants"]', '2');
  await page.fill('[name="date"]', '2025-12-01');
  await page.click('button:has-text("–û–ø–ª–∞—Ç–∏—Ç—å")');
  
  await expect(page).toHaveURL(/\/payment/);
});
```

–°—Ü–µ–Ω–∞—Ä–∏–∏:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–∞
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
- –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ CloudPayments
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏ (–æ–ø–µ—Ä–∞—Ç–æ—Ä)

---

### –®–ê–ì 6: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN (2 —á–∞—Å–∞)

#### 6.1 Vercel CDN (–µ—Å–ª–∏ –¥–µ–ø–ª–æ–π –Ω–∞ Vercel)
```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['cdn.kamhub.ru'],
    formats: ['image/avif', 'image/webp'],
  },
  
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ];
  },
};
```

#### 6.2 Cloudflare CDN (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS
- –í–∫–ª—é—á–∏—Ç—å Auto Minify
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Page Rules
- –í–∫–ª—é—á–∏—Ç—å Brotli compression

---

## üìÖ –†–ê–°–ü–ò–°–ê–ù–ò–ï –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –î–µ–Ω—å 1 (7 –Ω–æ—è–±—Ä—è) - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```
09:00-09:30  ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å mock-operator-id
09:30-10:00  ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞  
10:00-11:00  ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –º–æ–∫–∏ –≤ admin stats
11:00-12:00  ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
12:00-14:00  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Auth —Ç–µ—Å—Ç—ã
14:00-17:00  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Bookings —Ç–µ—Å—Ç—ã
17:00-18:00  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Payments —Ç–µ—Å—Ç—ã (—á–∞—Å—Ç—å)
```

### –î–µ–Ω—å 2 (8 –Ω–æ—è–±—Ä—è) - –¢–µ—Å—Ç—ã + Sentry
```
09:00-11:00  –ó–∞–≤–µ—Ä—à–∏—Ç—å Payments —Ç–µ—Å—Ç—ã
11:00-13:00  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Reviews —Ç–µ—Å—Ç—ã
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
14:00-16:00  –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Sentry
16:00-18:00  –ó–∞–º–µ–Ω–∏—Ç—å console.log –Ω–∞ Sentry (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã)
```

### –î–µ–Ω—å 3 (9 –Ω–æ—è–±—Ä—è) - E2E + CDN
```
09:00-10:00  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright
10:00-13:00  –ù–∞–ø–∏—Å–∞—Ç—å E2E —Ç–µ—Å—Ç—ã
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
14:00-16:00  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN
16:00-18:00  –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üéØ –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

```
‚úÖ 0 mock ID –≤ production –∫–æ–¥–µ
‚úÖ 190+ —Ä–µ–∞–ª—å–Ω—ã—Ö unit —Ç–µ—Å—Ç–æ–≤
‚úÖ 5+ E2E —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
‚úÖ Sentry –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –æ—à–∏–±–∫–∏
‚úÖ CDN –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >70%
‚úÖ 0 TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ console.log
```

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

**–ù–ê–ß–ò–ù–ê–ï–ú –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°!**

–ü–æ—Ä—è–¥–æ–∫:
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å mock-operator-id ‚Üí 10 –º–∏–Ω—É—Ç
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–¥–º–∏–Ω–∞ ‚Üí 15 –º–∏–Ω—É—Ç  
3. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –º–æ–∫–∏ –≤ stats ‚Üí 30 –º–∏–Ω—É—Ç
4. ‚è≠Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É ‚Üí 1 —á–∞—Å
5. ‚è≠Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Ç–µ—Å—Ç—ã ‚Üí 2 —á–∞—Å–∞
6. ‚è≠Ô∏è –ò –¥–∞–ª–µ–µ –ø–æ –ø–ª–∞–Ω—É...

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å?** üî•





